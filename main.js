!function(){"use strict";class e{constructor(e,t){this._settings=e,this._form=t}_showInputError(e,t){const o=this._form.querySelector(".".concat(e.id,"-error"));e.classList.add(this._settings.inputErrorClass),o.textContent=t,o.classList.add(this._settings.errorClass)}_hideInputError(e){const t=this._form.querySelector(".".concat(e.id,"-error"));e.classList.remove(this._settings.inputErrorClass),t.classList.remove(this._settings.errorClass),t.textContent=""}_checkInputValidity(e){e.validity.valid?this._hideInputError(e):this._showInputError(e,e.validationMessage)}_hasInvalidInput(){return this._inputList.some((e=>!e.validity.valid))}_toggleButtonState(){this._hasInvalidInput()?(this._buttonElement.classList.add(this._settings.inactiveButtonClass),this._buttonElement.setAttribute("disabled",!0)):(this._buttonElement.classList.remove(this._settings.inactiveButtonClass),this._buttonElement.removeAttribute("disabled"))}_setEventListeners(){this._inputList=Array.from(this._form.querySelectorAll(this._settings.inputSelector)),this._buttonElement=this._form.querySelector(this._settings.submitButtonSelector),this._toggleButtonState(),this._inputList.forEach((e=>{e.addEventListener("input",(()=>{this._checkInputValidity(e),this._toggleButtonState()}))}))}resetValidation(){this._inputList.forEach((e=>{this._hideInputError(e),this._toggleButtonState()}))}enableValidation(){this._setEventListeners(this._form),this._form.addEventListener("submit",(function(e){e.preventDefault()}))}}function t(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}document.querySelector(".popup-photo");class o{constructor(e,o,r,s,n){let{_id:i,name:c,link:a}=e;t(this,"_handleLikeEvent",(()=>{this._element.querySelector(".photo-card__like-button").classList.toggle("photo-card__like-button_active")})),t(this,"_handleDeleteEvent",(()=>{this._handleDeleteCardClick()})),this._id=i,this._name=c,this._image=a,this._cardSelector=o,this._handleCardClick=r,this._handleDeleteCardClick=s}getId(){return this._id}createCard(){return this._element=this._createNewPhotoCardElement(),this._addEventListeners(),this._element}deleteCard(){this._element.remove(),this._element=null}_addEventListeners(){const e=this._element.querySelector(".photo-card__like-button");this._addLikeEventListener(e);const t=this._element.querySelector(".photo-card__delete-button");this._addDeleteEventListener(t);const o=this._element.querySelector(".photo-card__photo");this._addOpenPhotoEventListener(o)}_createNewPhotoCardElement(){const e=this._cardSelector.querySelector(".photo-card").cloneNode(!0),t=e.querySelector(".photo-card__photo"),o=e.querySelector(".photo-card__title");return t.src=this._image,t.alt=this._name,o.textContent=this._name,e}_addLikeEventListener(e){e.addEventListener("click",this._handleLikeEvent)}_addDeleteEventListener(e){e.addEventListener("click",this._handleDeleteEvent)}_addOpenPhotoEventListener(e){e.addEventListener("click",(()=>{this._handleCardClick()}))}}function r(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}class s{constructor(e){r(this,"_handleEscClose",(e=>{"Escape"==e.key&&this._popup.classList.contains("popup_opened")&&this.close()})),r(this,"_handleClickOnOverlayClose",(e=>{e.target.classList.contains("popup")&&this.close()})),this._popup=document.querySelector(e)}open(){this._popup.classList.add("popup_opened"),this.setEventListeners()}close(){this._popup.classList.remove("popup_opened"),this.removeEventListeners()}setEventListeners(){document.addEventListener("click",this._handleClickOnOverlayClose),document.addEventListener("keydown",this._handleEscClose),this._popup.querySelector(".popup__close-button").addEventListener("click",close)}removeEventListeners(){document.removeEventListener("click",this._handleClickOnOverlayClose),document.removeEventListener("keydown",this._handleEscClose),this._popup.querySelector(".popup__close-button").removeEventListener("click",close)}}class n extends s{constructor(e,t){var o,r;super(e),r=e=>{e.preventDefault(),this._handleSubmit(),this.close()},(o="_handleProfileFormSubmit")in this?Object.defineProperty(this,o,{value:r,enumerable:!0,configurable:!0,writable:!0}):this[o]=r,this._handleSubmit=t,this._form=this._popup.querySelector(".form")}_getInputValues(){const e={};return Array.from(this._popup.querySelectorAll(".form__text-input")).forEach((t=>{e[t.getAttribute("name")]=t.value})),e}setEventListeners(){this._form.addEventListener("submit",this._handleProfileFormSubmit),super.setEventListeners()}removeEventListeners(){this._form.removeEventListener("submit",this._handleProfileFormSubmit),super.removeEventListeners()}close(){this._form.reset(),super.close()}}class i{constructor(e,t){let{items:o,renderer:r}=e;this._items=o,this._renderer=r,this._container=document.querySelector(t)}clear(){this._container.innerHTML=""}renderer(){this.clear(),this._items.forEach((e=>{this.addItem(this._renderer(e))}))}addItem(e){this._container.prepend(e)}}const c=document.querySelector(".popup-edit"),a=document.querySelector(".popup-add"),l=document.querySelector(".popup-photo"),u=document.querySelector(".popup-delete"),h=c.querySelector(".popup__close-button"),d=a.querySelector(".popup__close-button"),_=l.querySelector(".popup__close-button"),p=(u.querySelector(".popup__close-button"),c.querySelector(".form")),m=p.querySelector('.form__text-input[name="name"]'),f=p.querySelector('.form__text-input[name="about-me"]'),v=a.querySelector(".form"),E=v.querySelector('.form__text-input[name="title"]'),b=v.querySelector('.form__text-input[name="image-link"]'),y=(u.querySelector(".form"),document.querySelector(".profile")),S=y.querySelector(".profile__edit-button"),L=y.querySelector(".profile__add-button"),g=document.querySelector("#photo-card__template").content,C=new Map;let k;const q={formSelector:".form",inputSelector:".form__text-input",submitButtonSelector:".form__submit-button",inactiveButtonClass:"form__submit-button_disabled",inputErrorClass:"form__text-input-error_active",errorClass:"form__input-error_visible"};function j(e){return new o(e,g,P,I).createCard()}function P(){D.open(this._image,this._name)}function I(){N.open(),k=this}const w=new class{constructor(e){this._options=e}getInitialCards(){return fetch(this._options.baseUrl+"/cards/",{headers:this._options.headers}).then((e=>e.ok?e.json():Promise.reject("Error: ".concat(e.status)))).then((e=>e)).catch((e=>Promise.reject("Error: ".concat(e.status)))).finally((()=>{console.log("All done")}))}setNewCard(e){let{cardName:t,cardLink:o}=e;return fetch(this._options.baseUrl+"/cards/",{method:"POST",headers:this._options.headers,body:JSON.stringify({name:t,link:o})}).then((e=>e.ok?e.json():Promise.reject("Error: ".concat(e.status)))).then((e=>e)).catch((e=>Promise.reject("Error: ".concat(e.status)))).finally((()=>{console.log("All done")}))}addLike(e){return fetch(this._options.baseUrl+"/cards/likes/"+e,{method:"PUT",headers:this._options.headers}).then((e=>e.ok?e.json():Promise.reject("Error: ".concat(e.status)))).then((e=>e)).catch((e=>Promise.reject("Error: ".concat(e.status)))).finally((()=>{console.log("All done")}))}removeLike(e){return fetch(this._options.baseUrl+"/cards/likes/"+e,{method:"DELETE",headers:this._options.headers}).then((e=>e.ok?e.json():Promise.reject("Error: ".concat(e.status)))).then((e=>e)).catch((e=>Promise.reject("Error: ".concat(e.status)))).finally((()=>{console.log("All done")}))}deleteCard(e){return fetch(this._options.baseUrl+"/cards/"+e,{method:"DELETE",headers:this._options.headers}).then((e=>e.ok?e.json():Promise.reject("Error: ".concat(e.status)))).then((e=>e)).catch((e=>Promise.reject("Error: ".concat(e.status)))).finally((()=>{console.log("All done")}))}getUserInfo(){return fetch(this._options.baseUrl+"/users/me",{headers:this._options.headers}).then((e=>e.ok?e.json():Promise.reject("Error: ".concat(e.status)))).then((e=>e)).catch((e=>Promise.reject("Error: ".concat(e.status)))).finally((()=>{console.log("All done")}))}setUserInfo(e){let{newName:t,newAbout:o}=e;return fetch(this._options.baseUrl+"/users/me",{method:"PATCH",headers:this._options.headers,body:JSON.stringify({name:t,about:o})}).then((e=>e.ok?e.json():Promise.reject("Error: ".concat(e.status)))).then((e=>e)).catch((e=>Promise.reject("Error: ".concat(e.status)))).finally((()=>{console.log("All done")}))}updateAvatar(e){return fetch(this._options.baseUrl+"/users/me/avatar",{method:"PATCH",headers:this._options.headers,body:JSON.stringify({avatar:e})}).then((e=>e.ok?e.json():Promise.reject("Error: ".concat(e.status)))).then((e=>e)).catch((e=>Promise.reject("Error: ".concat(e.status)))).finally((()=>{console.log("All done")}))}}({baseUrl:"https://around.nomoreparties.co/v1/group-12",headers:{authorization:"b9d1c3b6-c0f4-4224-ad8f-4c81efa3f89d","Content-Type":"application/json"}}),A=new class{constructor(e){let{nameSelector:t,jobSelector:o}=e;this._nameSelector=t,this._jobSelector=o}getUserInfo(){return{name:document.querySelector(this._nameSelector).textContent,job:document.querySelector(this._jobSelector).textContent}}setUserInfo(e){let{name:t,about:o}=e;const r=document.querySelector(this._nameSelector),s=document.querySelector(this._jobSelector);r.textContent=t,s.textContent=o}}({nameSelector:".profile__name",jobSelector:".profile__description"});let U;w.getUserInfo().then((e=>{A.setUserInfo(e)})),w.getInitialCards().then((e=>{U=new i({items:e,renderer:j},".photos__grid"),U.renderer()}));const x=new n(".popup-add",(function(){const e={cardName:E.value,cardLink:b.value};w.setNewCard(e).then((e=>{const t=new o(e,g,P,I);U.addItem(t.createCard())}))})),O=new n(".popup-edit",(function(){w.setUserInfo({newName:m.value,newAbout:f.value}).then((e=>{A.setUserInfo(e)}))})),N=new n(".popup-delete",(function(){w.deleteCard(k.getId()).then((()=>{console.log("Card deleted"),k.deleteCard(),k=null}))})),D=new class extends s{constructor(e){super(e)}open(e,t){const o=this._popup.querySelector(".popup-photo__container"),r=o.querySelector(".popup-photo__photo"),s=o.querySelector(".popup-photo__title");r.src=e,s.textContent=t,r.alt=t,super.open()}}(".popup-photo");Array.from(document.querySelectorAll(q.formSelector)).forEach((t=>{const o=t.getAttribute("name"),r=new e(q,t);r.enableValidation(),C.set(o,r)})),L.addEventListener("click",(()=>{x.open(),C.get("add-form").resetValidation()})),d.addEventListener("click",(()=>{x.close()})),S.addEventListener("click",(()=>{const e=A.getUserInfo();m.value=e.name,f.value=e.job,O.open(),C.get("edit-form").resetValidation()})),h.addEventListener("click",(()=>{O.close()})),_.addEventListener("click",(()=>{D.close()}))}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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RUFBZ0IsSUFBSW5NLEVBQWN1SSxFQUFrQjBELEdBQzFERSxFQUFjMUosbUJBQ2QyRixFQUFNZ0UsSUFBSUYsRUFBVUMsTUFxRHhCbEUsRUFBVTFGLGlCQUFpQixTQUFTLEtBQ2xDb0osRUFBU3RHLE9BQ1QrQyxFQUFNaUUsSUE3TFksWUE2TEs3SixxQkFHekIrRSxFQUFlaEYsaUJBQWlCLFNBQVMsS0FDdkNvSixFQUFTeEcsV0FLWDZDLEVBQVd6RixpQkFBaUIsU0FBUyxLQUNuQyxNQUFNK0osRUFBa0JwQixFQUFTUixjQUNqQ2hELEVBQVV2QixNQUFRbUcsRUFBZ0JuSixLQUNsQ3dFLEVBQWlCeEIsTUFBUW1HLEVBQWdCZixJQUN6Q00sRUFBVXhHLE9BQ1YrQyxFQUFNaUUsSUE1TWEsYUE0TUs3SixxQkFHMUI4RSxFQUFnQi9FLGlCQUFpQixTQUFTLEtBQ3hDc0osRUFBVTFHLFdBS1pxQyxFQUFpQmpGLGlCQUFpQixTQUFTLEtBQ3pDcUcsRUFBV3pELFciLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvRm9ybVZhbGlkYXRvci5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvQ2FyZC5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvUG9wdXAuanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL1BvcHVwV2l0aEZvcm0uanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL1NlY3Rpb24uanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9pbmRleC5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvQXBpLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy9Vc2VySW5mby5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvUG9wdXBXaXRoSW1hZ2UuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY2xhc3MgRm9ybVZhbGlkYXRvciB7XG4gIGNvbnN0cnVjdG9yKHNldHRpbmdzLCBmb3JtKXtcbiAgICB0aGlzLl9zZXR0aW5ncyA9IHNldHRpbmdzO1xuICAgIHRoaXMuX2Zvcm0gPSBmb3JtO1xuICB9XG5cbiAgX3Nob3dJbnB1dEVycm9yKGlucHV0RWxlbWVudCwgZXJyb3JNZXNzYWdlKSB7XG4gICAgY29uc3QgZXJyb3JFbGVtZW50ID0gdGhpcy5fZm9ybS5xdWVyeVNlbGVjdG9yKGAuJHtpbnB1dEVsZW1lbnQuaWR9LWVycm9yYCk7XG4gICAgaW5wdXRFbGVtZW50LmNsYXNzTGlzdC5hZGQodGhpcy5fc2V0dGluZ3MuaW5wdXRFcnJvckNsYXNzKTtcbiAgICBlcnJvckVsZW1lbnQudGV4dENvbnRlbnQgPSBlcnJvck1lc3NhZ2U7XG4gICAgZXJyb3JFbGVtZW50LmNsYXNzTGlzdC5hZGQodGhpcy5fc2V0dGluZ3MuZXJyb3JDbGFzcyk7XG4gIH07XG5cbiAgX2hpZGVJbnB1dEVycm9yKGlucHV0RWxlbWVudCkge1xuICAgIGNvbnN0IGVycm9yRWxlbWVudCA9IHRoaXMuX2Zvcm0ucXVlcnlTZWxlY3RvcihgLiR7aW5wdXRFbGVtZW50LmlkfS1lcnJvcmApO1xuICAgIGlucHV0RWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuX3NldHRpbmdzLmlucHV0RXJyb3JDbGFzcyk7XG4gICAgZXJyb3JFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUodGhpcy5fc2V0dGluZ3MuZXJyb3JDbGFzcyk7XG4gICAgZXJyb3JFbGVtZW50LnRleHRDb250ZW50ID0gXCJcIjtcbiAgfTtcblxuICBfY2hlY2tJbnB1dFZhbGlkaXR5KGlucHV0RWxlbWVudCkge1xuICAgIGlmICghaW5wdXRFbGVtZW50LnZhbGlkaXR5LnZhbGlkKSB7XG4gICAgICB0aGlzLl9zaG93SW5wdXRFcnJvcihpbnB1dEVsZW1lbnQsIGlucHV0RWxlbWVudC52YWxpZGF0aW9uTWVzc2FnZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuX2hpZGVJbnB1dEVycm9yKGlucHV0RWxlbWVudCk7XG4gICAgfVxuICB9O1xuXG4gIF9oYXNJbnZhbGlkSW5wdXQoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2lucHV0TGlzdC5zb21lKChpbnB1dEVsZW1lbnQpID0+IHtcbiAgICAgIHJldHVybiAhaW5wdXRFbGVtZW50LnZhbGlkaXR5LnZhbGlkO1xuICAgIH0pO1xuICB9O1xuXG4gIF90b2dnbGVCdXR0b25TdGF0ZSgpIHtcbiAgICBpZiAodGhpcy5faGFzSW52YWxpZElucHV0KCkpIHtcbiAgICAgIHRoaXMuX2J1dHRvbkVsZW1lbnQuY2xhc3NMaXN0LmFkZCh0aGlzLl9zZXR0aW5ncy5pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcbiAgICAgIHRoaXMuX2J1dHRvbkVsZW1lbnQuc2V0QXR0cmlidXRlKFwiZGlzYWJsZWRcIiwgdHJ1ZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuX2J1dHRvbkVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSh0aGlzLl9zZXR0aW5ncy5pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcbiAgICAgIHRoaXMuX2J1dHRvbkVsZW1lbnQucmVtb3ZlQXR0cmlidXRlKFwiZGlzYWJsZWRcIik7XG4gICAgfVxuICB9O1xuXG4gIF9zZXRFdmVudExpc3RlbmVycygpIHtcbiAgICB0aGlzLl9pbnB1dExpc3QgPSBBcnJheS5mcm9tKHRoaXMuX2Zvcm0ucXVlcnlTZWxlY3RvckFsbCh0aGlzLl9zZXR0aW5ncy5pbnB1dFNlbGVjdG9yKSk7XG4gICAgdGhpcy5fYnV0dG9uRWxlbWVudCA9IHRoaXMuX2Zvcm0ucXVlcnlTZWxlY3Rvcih0aGlzLl9zZXR0aW5ncy5zdWJtaXRCdXR0b25TZWxlY3Rvcik7XG5cbiAgICB0aGlzLl90b2dnbGVCdXR0b25TdGF0ZSgpO1xuXG4gICAgdGhpcy5faW5wdXRMaXN0LmZvckVhY2goKGlucHV0RWxlbWVudCkgPT4ge1xuICAgICAgaW5wdXRFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJpbnB1dFwiLCAoKSA9PiB7XG4gICAgICAgIHRoaXMuX2NoZWNrSW5wdXRWYWxpZGl0eShpbnB1dEVsZW1lbnQpO1xuICAgICAgICB0aGlzLl90b2dnbGVCdXR0b25TdGF0ZSgpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH07XG5cbiAgcmVzZXRWYWxpZGF0aW9uKCl7XG4gICAgdGhpcy5faW5wdXRMaXN0LmZvckVhY2goKGlucHV0RWxlbWVudCkgPT4ge1xuICAgICAgdGhpcy5faGlkZUlucHV0RXJyb3IoaW5wdXRFbGVtZW50KTtcbiAgICAgIHRoaXMuX3RvZ2dsZUJ1dHRvblN0YXRlKCk7XG4gICAgfSk7XG4gIH1cblxuICBlbmFibGVWYWxpZGF0aW9uKCkge1xuICAgIHRoaXMuX3NldEV2ZW50TGlzdGVuZXJzKHRoaXMuX2Zvcm0pO1xuICAgIHRoaXMuX2Zvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCBmdW5jdGlvbiAoZXZ0KSB7XG4gICAgICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgICB9KTtcbiAgfTtcbn1cblxuXG5leHBvcnQge0Zvcm1WYWxpZGF0b3J9O1xuIiwiXG5jb25zdCBwb3B1cFBob3RvID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBvcHVwLXBob3RvJyk7XG5cblxuY2xhc3MgQ2FyZCB7XG5cbiAgICBjb25zdHJ1Y3Rvcih7IF9pZCwgbmFtZSwgbGluayB9LCBjYXJkU2VsZWN0b3IsIGhhbmRsZUNhcmRDbGljaywgaGFuZGxlRGVsZXRlQ2FyZENsaWNrLCBoYW5kbGVDYXJkRGVsZXRlU3VibWl0KSB7XG5cbiAgICAgICAgdGhpcy5faWQgPSBfaWQ7XG4gICAgICAgIHRoaXMuX25hbWUgPSBuYW1lO1xuICAgICAgICB0aGlzLl9pbWFnZSA9IGxpbms7XG4gICAgICAgIHRoaXMuX2NhcmRTZWxlY3RvciA9IGNhcmRTZWxlY3RvcjtcbiAgICAgICAgdGhpcy5faGFuZGxlQ2FyZENsaWNrID0gaGFuZGxlQ2FyZENsaWNrO1xuICAgICAgICB0aGlzLl9oYW5kbGVEZWxldGVDYXJkQ2xpY2sgPSBoYW5kbGVEZWxldGVDYXJkQ2xpY2s7XG4gICAgfVxuXG4gICAgZ2V0SWQoKSB7XG4gICAgICByZXR1cm4gdGhpcy5faWQ7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBvbmUgc2luZ2xlIHBob3RvIGNhcmQgd2l0aCBzcGVjaWZpZWQgY2FyZCBpbmZvcm1hdGlvbiAob2JqZWN0KVxuICAgICAqIEBwYXJhbSB7b2JqZWN0fSBjYXJkXG4gICAgICogQHJldHVybnMgcGhvdG9DYXJkIHRvIGJlIHJlbmRlcmVkXG4gICAgICovXG4gICAgY3JlYXRlQ2FyZCgpIHtcbiAgICAgIHRoaXMuX2VsZW1lbnQgPSB0aGlzLl9jcmVhdGVOZXdQaG90b0NhcmRFbGVtZW50KCk7XG4gICAgICB0aGlzLl9hZGRFdmVudExpc3RlbmVycygpO1xuXG4gICAgICByZXR1cm4gdGhpcy5fZWxlbWVudDtcbiAgICB9XG5cbiAgICBkZWxldGVDYXJkKCkge1xuICAgICAgdGhpcy5fZWxlbWVudC5yZW1vdmUoKTtcbiAgICAgIHRoaXMuX2VsZW1lbnQgPSBudWxsO1xuICAgIH1cblxuICAgIF9hZGRFdmVudExpc3RlbmVycygpe1xuXG4gICAgICAgIGNvbnN0IGxpa2VCdXR0b24gPSB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucGhvdG8tY2FyZF9fbGlrZS1idXR0b25cIik7XG4gICAgICAgIHRoaXMuX2FkZExpa2VFdmVudExpc3RlbmVyKGxpa2VCdXR0b24pO1xuXG4gICAgICAgIGNvbnN0IGRlbGV0ZUJ1dHRvbiA9IHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5waG90by1jYXJkX19kZWxldGUtYnV0dG9uXCIpO1xuICAgICAgICB0aGlzLl9hZGREZWxldGVFdmVudExpc3RlbmVyKGRlbGV0ZUJ1dHRvbik7XG5cbiAgICAgICAgY29uc3QgcGhvdG8gPSB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucGhvdG8tY2FyZF9fcGhvdG9cIik7XG4gICAgICAgIHRoaXMuX2FkZE9wZW5QaG90b0V2ZW50TGlzdGVuZXIocGhvdG8pO1xuICAgIH1cblxuICAgIF9jcmVhdGVOZXdQaG90b0NhcmRFbGVtZW50KCkge1xuICAgICAgICBjb25zdCBwaG90b0NhcmQgPSB0aGlzLl9jYXJkU2VsZWN0b3IucXVlcnlTZWxlY3RvcihcIi5waG90by1jYXJkXCIpLmNsb25lTm9kZSh0cnVlKTtcblxuICAgICAgICBjb25zdCBwaG90byA9IHBob3RvQ2FyZC5xdWVyeVNlbGVjdG9yKFwiLnBob3RvLWNhcmRfX3Bob3RvXCIpO1xuICAgICAgICBjb25zdCBwaG90b1RpdGxlID0gcGhvdG9DYXJkLnF1ZXJ5U2VsZWN0b3IoXCIucGhvdG8tY2FyZF9fdGl0bGVcIik7XG5cbiAgICAgICAgcGhvdG8uc3JjID0gdGhpcy5faW1hZ2U7XG4gICAgICAgIHBob3RvLmFsdCA9IHRoaXMuX25hbWU7XG4gICAgICAgIHBob3RvVGl0bGUudGV4dENvbnRlbnQgPSB0aGlzLl9uYW1lO1xuXG4gICAgICAgIHJldHVybiBwaG90b0NhcmQ7XG4gICAgfVxuXG4gICAgLypcbiAgICBLZWVwaW5nIGNvbW1lbnQgZm9yIGxlYXJuaW5nIHB1cnBvc2VzXG4gICAgZGVjbGFyZSBtZXRob2RzIGFzIGFycm93IGZ1bmN0aW9ucyB0byBub3QgbG9zZSBjb250ZXh0IGB0aGlzYC4gYHRoaXNgIGlzIENhcmQgaW5zdGFuY2UgaGVyZVxuICAgICovXG4gICAgX2hhbmRsZUxpa2VFdmVudCA9ICgpID0+IHtcbiAgICAgIGNvbnN0IGxpa2VCdXR0b24gPSB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucGhvdG8tY2FyZF9fbGlrZS1idXR0b25cIik7XG4gICAgICBsaWtlQnV0dG9uLmNsYXNzTGlzdC50b2dnbGUoJ3Bob3RvLWNhcmRfX2xpa2UtYnV0dG9uX2FjdGl2ZScpO1xuICAgIH1cblxuICAgIF9hZGRMaWtlRXZlbnRMaXN0ZW5lcihsaWtlQnV0dG9uKSB7XG4gICAgICAgIGxpa2VCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHRoaXMuX2hhbmRsZUxpa2VFdmVudCk7XG4gICAgfVxuXG4gICAgX2hhbmRsZURlbGV0ZUV2ZW50ID0gKCkgPT4ge1xuICAgICAgdGhpcy5faGFuZGxlRGVsZXRlQ2FyZENsaWNrKCk7XG4gICAgfVxuXG4gICAgX2FkZERlbGV0ZUV2ZW50TGlzdGVuZXIoZGVsZXRlQnV0dG9uKSB7XG4gICAgICAgIGRlbGV0ZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgdGhpcy5faGFuZGxlRGVsZXRlRXZlbnQpO1xuICAgIH1cblxuICAgIF9hZGRPcGVuUGhvdG9FdmVudExpc3RlbmVyKHBob3RvKSB7XG4gICAgICAgIHBob3RvLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICAgICAgdGhpcy5faGFuZGxlQ2FyZENsaWNrKCk7XG4gICAgICAgIH0pO1xuICAgIH1cblxufVxuXG5leHBvcnQge0NhcmR9XG4iLCJjbGFzcyBQb3B1cCB7XG4gICAgY29uc3RydWN0b3IocG9wdXBTZWxlY3Rvcikge1xuICAgICAgICB0aGlzLl9wb3B1cCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IocG9wdXBTZWxlY3Rvcik7XG4gICAgfVxuXG4gICAgb3BlbigpIHtcbiAgICAgICAgdGhpcy5fcG9wdXAuY2xhc3NMaXN0LmFkZChcInBvcHVwX29wZW5lZFwiKTtcbiAgICAgICAgdGhpcy5zZXRFdmVudExpc3RlbmVycygpO1xuICAgIH1cblxuICAgIGNsb3NlKCkge1xuICAgICAgICB0aGlzLl9wb3B1cC5jbGFzc0xpc3QucmVtb3ZlKFwicG9wdXBfb3BlbmVkXCIpO1xuICAgICAgICB0aGlzLnJlbW92ZUV2ZW50TGlzdGVuZXJzKCk7XG4gICAgfVxuXG4gICAgc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XG4gICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgdGhpcy5faGFuZGxlQ2xpY2tPbk92ZXJsYXlDbG9zZSk7XG4gICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCB0aGlzLl9oYW5kbGVFc2NDbG9zZSk7XG4gICAgICB0aGlzLl9wb3B1cC5xdWVyeVNlbGVjdG9yKCcucG9wdXBfX2Nsb3NlLWJ1dHRvbicpLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBjbG9zZSk7XG4gICAgfVxuXG4gICAgcmVtb3ZlRXZlbnRMaXN0ZW5lcnMoKSB7XG4gICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgdGhpcy5faGFuZGxlQ2xpY2tPbk92ZXJsYXlDbG9zZSk7XG4gICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCB0aGlzLl9oYW5kbGVFc2NDbG9zZSk7XG4gICAgICB0aGlzLl9wb3B1cC5xdWVyeVNlbGVjdG9yKCcucG9wdXBfX2Nsb3NlLWJ1dHRvbicpLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBjbG9zZSk7XG4gICAgfVxuXG4gICAgX2hhbmRsZUVzY0Nsb3NlID0gKGV2dCkgPT4ge1xuICAgICAgICBpZihldnQua2V5ID09IFwiRXNjYXBlXCIgJiYgdGhpcy5fcG9wdXAuY2xhc3NMaXN0LmNvbnRhaW5zKCdwb3B1cF9vcGVuZWQnKSl7XG4gICAgICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBfaGFuZGxlQ2xpY2tPbk92ZXJsYXlDbG9zZSA9IChldnQpID0+IHtcbiAgICAgICAgaWYoZXZ0LnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoXCJwb3B1cFwiKSl7XG4gICAgICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICAgIH1cbiAgfVxuXG59XG5cbmV4cG9ydCB7UG9wdXB9O1xuIiwiaW1wb3J0IHsgUG9wdXAgfSBmcm9tIFwiLi9Qb3B1cC5qc1wiO1xuXG5jbGFzcyBQb3B1cFdpdGhGb3JtIGV4dGVuZHMgUG9wdXAge1xuICAgIGNvbnN0cnVjdG9yKHBvcHVwU2VsZWN0b3IsIGhhbmRsZVN1Ym1pdCkge1xuICAgICAgc3VwZXIocG9wdXBTZWxlY3Rvcik7XG4gICAgICB0aGlzLl9oYW5kbGVTdWJtaXQgPSBoYW5kbGVTdWJtaXQ7XG4gICAgICB0aGlzLl9mb3JtID0gdGhpcy5fcG9wdXAucXVlcnlTZWxlY3RvcignLmZvcm0nKTtcbiAgICB9XG5cbiAgICBfZ2V0SW5wdXRWYWx1ZXMoKSB7XG4gICAgICAgIGNvbnN0IGlucHV0VmFsdWVzID0ge307XG4gICAgICAgIGNvbnN0IGlucHV0cyA9IEFycmF5LmZyb20odGhpcy5fcG9wdXAucXVlcnlTZWxlY3RvckFsbChcIi5mb3JtX190ZXh0LWlucHV0XCIpKTtcblxuICAgICAgICBpbnB1dHMuZm9yRWFjaCgoaW5wdXQpID0+IHtcbiAgICAgICAgICAgIGlucHV0VmFsdWVzW2lucHV0LmdldEF0dHJpYnV0ZSgnbmFtZScpXSA9IGlucHV0LnZhbHVlO1xuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4gaW5wdXRWYWx1ZXM7XG4gICAgfVxuXG4gICAgc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XG4gICAgICB0aGlzLl9mb3JtLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgdGhpcy5faGFuZGxlUHJvZmlsZUZvcm1TdWJtaXQpO1xuICAgICAgc3VwZXIuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcbiAgICB9XG5cbiAgICByZW1vdmVFdmVudExpc3RlbmVycygpIHtcbiAgICAgIHRoaXMuX2Zvcm0ucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCB0aGlzLl9oYW5kbGVQcm9maWxlRm9ybVN1Ym1pdCk7XG4gICAgICBzdXBlci5yZW1vdmVFdmVudExpc3RlbmVycygpO1xuICAgIH1cblxuICAgIGNsb3NlKCkge1xuICAgICAgICB0aGlzLl9mb3JtLnJlc2V0KCk7XG4gICAgICAgIHN1cGVyLmNsb3NlKCk7XG4gICAgfVxuXG4gICAgX2hhbmRsZVByb2ZpbGVGb3JtU3VibWl0ID0gKGV2dCkgPT4ge1xuICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICB0aGlzLl9oYW5kbGVTdWJtaXQoKTtcbiAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICB9XG59XG5cbmV4cG9ydCB7IFBvcHVwV2l0aEZvcm0gfVxuIiwiY2xhc3MgU2VjdGlvbiB7XG4gICAgY29uc3RydWN0b3IoIHsgaXRlbXMsIHJlbmRlcmVyIH0sIGNvbnRhaW5lclNlbGVjdG9yKSB7XG4gICAgICAgIHRoaXMuX2l0ZW1zID0gaXRlbXM7XG4gICAgICAgIHRoaXMuX3JlbmRlcmVyID0gcmVuZGVyZXI7XG4gICAgICAgIHRoaXMuX2NvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoY29udGFpbmVyU2VsZWN0b3IpO1xuICAgIH1cblxuICAgIGNsZWFyKCkge1xuICAgICAgICB0aGlzLl9jb250YWluZXIuaW5uZXJIVE1MID0gXCJcIjtcbiAgICB9XG5cbiAgICByZW5kZXJlcigpIHtcbiAgICAgICAgdGhpcy5jbGVhcigpO1xuXG4gICAgICAgIHRoaXMuX2l0ZW1zLmZvckVhY2goaXRlbSA9PiB7XG4gICAgICAgICAgdGhpcy5hZGRJdGVtKHRoaXMuX3JlbmRlcmVyKGl0ZW0pKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgYWRkSXRlbShpdGVtKSB7XG4gICAgICAgIHRoaXMuX2NvbnRhaW5lci5wcmVwZW5kKGl0ZW0pO1xuICAgIH1cbn1cblxuZXhwb3J0IHtTZWN0aW9ufVxuIiwiaW1wb3J0IFwiLi9zdHlsZXMvaW5kZXguY3NzXCI7XG5cbmltcG9ydCB7IEZvcm1WYWxpZGF0b3IgfSBmcm9tIFwiLi9jb21wb25lbnRzL0Zvcm1WYWxpZGF0b3IuanNcIjtcbmltcG9ydCB7IENhcmQgfSBmcm9tIFwiLi9jb21wb25lbnRzL0NhcmQuanNcIjtcbmltcG9ydCB7IFBvcHVwV2l0aEZvcm0gfSBmcm9tIFwiLi9jb21wb25lbnRzL1BvcHVwV2l0aEZvcm0uanNcIjtcbmltcG9ydCB7IFBvcHVwV2l0aEltYWdlIH0gZnJvbSBcIi4vY29tcG9uZW50cy9Qb3B1cFdpdGhJbWFnZS5qc1wiO1xuaW1wb3J0IHsgVXNlckluZm8gfSBmcm9tIFwiLi9jb21wb25lbnRzL1VzZXJJbmZvLmpzXCJcbmltcG9ydCB7IFNlY3Rpb24gfSBmcm9tIFwiLi9jb21wb25lbnRzL1NlY3Rpb24uanNcIjtcbmltcG9ydCB7IEFwaSB9IGZyb20gXCIuL2NvbXBvbmVudHMvQXBpLmpzXCJcblxuLy9UT0RPIGhvdyB0byB1c2UgaXQgb24gUG9wdXBGb3JtIHdoZW4gb3BlbmluZyBpdCwgdG8gcmV0cmlldmUgdGhlIGluZm8uXG5jb25zdCB1c2VyU2VsZWN0b3JzID0ge1xuICBuYW1lU2VsZWN0b3I6IFwiLnByb2ZpbGVfX25hbWVcIixcbiAgam9iU2VsZWN0b3I6IFwiLnByb2ZpbGVfX2Rlc2NyaXB0aW9uXCJcbn07XG5cbmNvbnN0IGluaXRpYWxVc2VySW5mbyA9IHtcbiAgbmV3TmFtZTogXCJKYWNxdWVzIENvdXN0ZWF1XCIsXG4gIG5ld0pvYjogXCJFeHBsb3JlclwiXG59O1xuXG4vKiogRGVjbGFyYXRpb24gb2YgdGhlIFBvcHVwcyAqL1xuY29uc3QgcG9wdXBFZGl0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBvcHVwLWVkaXQnKTtcbmNvbnN0IHBvcHVwQWRkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBvcHVwLWFkZCcpO1xuY29uc3QgcG9wdXBQaG90byA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cC1waG90bycpO1xuY29uc3QgcG9wdXBEZWxldGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucG9wdXAtZGVsZXRlJylcblxuLyoqIERlY2xhcmF0aW9uIG9mIHRoZSBDbG9zZSBCdXR0b25zICovXG5jb25zdCBjbG9zZUJ1dHRvbkVkaXQgPSBwb3B1cEVkaXQucXVlcnlTZWxlY3RvcignLnBvcHVwX19jbG9zZS1idXR0b24nKTtcbmNvbnN0IGNsb3NlQnV0dG9uQWRkID0gcG9wdXBBZGQucXVlcnlTZWxlY3RvcignLnBvcHVwX19jbG9zZS1idXR0b24nKTtcbmNvbnN0IGNsb3NlQnV0dG9uUGhvdG8gPSBwb3B1cFBob3RvLnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cF9fY2xvc2UtYnV0dG9uJyk7XG5jb25zdCBjbG9zZUJ1dHRvbkRlbGV0ZSA9IHBvcHVwRGVsZXRlLnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cF9fY2xvc2UtYnV0dG9uJyk7XG5cbi8qKiBEZWNsYXJhdGlvbiBvZiB0aGUgRm9ybXMgKi9cblxuY29uc3QgZm9ybUVkaXROYW1lID0gJ2VkaXQtZm9ybSc7XG5jb25zdCBmb3JtQWRkTmFtZSA9ICdhZGQtZm9ybSc7XG5jb25zdCBmb3JtRGVsZXRlTmFtZSA9ICdkZWxldGUtZm9ybSc7XG5cbmNvbnN0IGZvcm1FZGl0ID0gcG9wdXBFZGl0LnF1ZXJ5U2VsZWN0b3IoJy5mb3JtJyk7XG5jb25zdCBuYW1lSW5wdXQgPSBmb3JtRWRpdC5xdWVyeVNlbGVjdG9yKCcuZm9ybV9fdGV4dC1pbnB1dFtuYW1lPVwibmFtZVwiXScpO1xuY29uc3QgZGVzY3JpcHRpb25JbnB1dCA9IGZvcm1FZGl0LnF1ZXJ5U2VsZWN0b3IoJy5mb3JtX190ZXh0LWlucHV0W25hbWU9XCJhYm91dC1tZVwiXScpO1xuXG5jb25zdCBmb3JtQWRkID0gcG9wdXBBZGQucXVlcnlTZWxlY3RvcignLmZvcm0nKTtcbmNvbnN0IHRpdGxlSW5wdXQgPSBmb3JtQWRkLnF1ZXJ5U2VsZWN0b3IoJy5mb3JtX190ZXh0LWlucHV0W25hbWU9XCJ0aXRsZVwiXScpO1xuY29uc3QgbGlua0lucHV0ID0gZm9ybUFkZC5xdWVyeVNlbGVjdG9yKCcuZm9ybV9fdGV4dC1pbnB1dFtuYW1lPVwiaW1hZ2UtbGlua1wiXScpO1xuXG5jb25zdCBmb3JtRGVsZXRlID0gcG9wdXBEZWxldGUucXVlcnlTZWxlY3RvcignLmZvcm0nKTtcblxuY29uc3QgcHJvZmlsZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wcm9maWxlJyk7XG5jb25zdCBlZGl0QnV0dG9uID0gcHJvZmlsZS5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2VkaXQtYnV0dG9uXCIpO1xuY29uc3QgYWRkQnV0dG9uID0gcHJvZmlsZS5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2FkZC1idXR0b25cIik7XG5cbi8qKiBEZWNsYXJhdGlvbiBvZiB0aGUgUGhvdG9zICovXG5jb25zdCBwaG90b0dyaWRTZWxlY3RvciA9IFwiLnBob3Rvc19fZ3JpZFwiO1xuY29uc3QgcGhvdG9DYXJkVGVtcGxhdGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3Bob3RvLWNhcmRfX3RlbXBsYXRlXCIpLmNvbnRlbnQ7XG5cbi8qKiBEZWNsYXJhdGlvbiBvZiB0aGUgSW5pdGlhbCBDYXJkcyAqL1xuY29uc3QgaW5pdGlhbENhcmRzID0gW1xuICB7XG4gICAgbmFtZTogXCJZb3NlbWl0ZSBWYWxsZXlcIixcbiAgICBsaW5rOiBcImh0dHBzOi8vY29kZS5zMy55YW5kZXgubmV0L3dlYi1jb2RlL3lvc2VtaXRlLmpwZ1wiXG4gIH0sXG4gIHtcbiAgICBuYW1lOiBcIkxha2UgTG91aXNlXCIsXG4gICAgbGluazogXCJodHRwczovL2NvZGUuczMueWFuZGV4Lm5ldC93ZWItY29kZS9sYWtlLWxvdWlzZS5qcGdcIlxuICB9LFxuICB7XG4gICAgbmFtZTogXCJCYWxkIE1vdW50YWluc1wiLFxuICAgIGxpbms6IFwiaHR0cHM6Ly9jb2RlLnMzLnlhbmRleC5uZXQvd2ViLWNvZGUvYmFsZC1tb3VudGFpbnMuanBnXCJcbiAgfSxcbiAge1xuICAgIG5hbWU6IFwiTGF0ZW1hclwiLFxuICAgIGxpbms6IFwiaHR0cHM6Ly9jb2RlLnMzLnlhbmRleC5uZXQvd2ViLWNvZGUvbGF0ZW1hci5qcGdcIlxuICB9LFxuICB7XG4gICAgbmFtZTogXCJWYW5vaXNlIE5hdGlvbmFsIFBhcmtcIixcbiAgICBsaW5rOiBcImh0dHBzOi8vY29kZS5zMy55YW5kZXgubmV0L3dlYi1jb2RlL3Zhbm9pc2UuanBnXCJcbiAgfSxcbiAge1xuICAgIG5hbWU6IFwiTGFnbyBkaSBCcmFpZXNcIixcbiAgICBsaW5rOiBcImh0dHBzOi8vY29kZS5zMy55YW5kZXgubmV0L3dlYi1jb2RlL2xhZ28uanBnXCJcbiAgfVxuXTtcblxuY29uc3QgZm9ybXMgPSBuZXcgTWFwKCk7XG5sZXQgY2FyZFRvRGVsZXRlO1xuXG4vKiogRGVjbGFyYXRpb24gb2YgdGhlIFNldHRpbmcgb2JqZWN0IGZvciBjYXJkIHZhbGlkYXRpb24gKi9cbmNvbnN0IHZhbGlkYXRpb25Db25maWcgPSB7XG4gIGZvcm1TZWxlY3RvcjogXCIuZm9ybVwiLFxuICBpbnB1dFNlbGVjdG9yOiBcIi5mb3JtX190ZXh0LWlucHV0XCIsXG4gIHN1Ym1pdEJ1dHRvblNlbGVjdG9yOiBcIi5mb3JtX19zdWJtaXQtYnV0dG9uXCIsXG4gIGluYWN0aXZlQnV0dG9uQ2xhc3M6IFwiZm9ybV9fc3VibWl0LWJ1dHRvbl9kaXNhYmxlZFwiLFxuICBpbnB1dEVycm9yQ2xhc3M6IFwiZm9ybV9fdGV4dC1pbnB1dC1lcnJvcl9hY3RpdmVcIixcbiAgZXJyb3JDbGFzczogXCJmb3JtX19pbnB1dC1lcnJvcl92aXNpYmxlXCJcbn07XG5cblxuLyoqXG4gKiBIYW5kbGVzIGNhcmQgY3JlYXRpb24gb24gU2VjdGlvblxuICogQHBhcmFtIHtzdHJpbmd9IG5hbWUgLSBUaGUgdGl0bGUgb2YgdGhlIGNhcmRcbiAqIEBwYXJhbSB7c3RyaW5nfSBsaW5rIC0gVGhlIGxpbmsgb2YgdGhlIHBob3RvXG4gKi9cbmZ1bmN0aW9uIHJlbmRlckNhcmQoY2FyZCkge1xuICBjb25zdCBuZXdDYXJkID0gbmV3IENhcmQoY2FyZCwgcGhvdG9DYXJkVGVtcGxhdGUsIGhhbmRsZUNhcmRDbGljaywgIGhhbmRsZUNhcmREZWxldGVDbGljayk7XG4gIGNvbnN0IHBob3RvQ2FyZCA9IG5ld0NhcmQuY3JlYXRlQ2FyZCgpO1xuICByZXR1cm4gcGhvdG9DYXJkO1xufVxuXG4vKipcbiAqIEhhbmRsZXMgbmV3IHBsYWNlIGZvcm0gc3VibWl0IChTZW50IHRvIHBvcHVwV2l0aEZvcm0pXG4gKi9cbmZ1bmN0aW9uIGhhbmRsZU5ld1BsYWNlRm9ybVN1Ym1pdCgpIHtcbiAgY29uc3QgY2FyZCA9IHtcbiAgICBjYXJkTmFtZTogdGl0bGVJbnB1dC52YWx1ZSxcbiAgICBjYXJkTGluazogbGlua0lucHV0LnZhbHVlXG4gIH07XG5cbiAgYXBpLnNldE5ld0NhcmQoY2FyZClcbiAgICAudGhlbihyZXMgPT4ge1xuICAgICAgY29uc3QgbmV3Q2FyZCA9IG5ldyBDYXJkKHJlcywgcGhvdG9DYXJkVGVtcGxhdGUsIGhhbmRsZUNhcmRDbGljaywgaGFuZGxlQ2FyZERlbGV0ZUNsaWNrKTtcbiAgICAgIHNlY3Rpb24uYWRkSXRlbShuZXdDYXJkLmNyZWF0ZUNhcmQoKSk7XG4gICAgfSlcbn1cblxuLyoqXG4gKiBIYW5kbGVzIG5ldyBwcm9maWxlIGZvcm0gc3VibWl0IChTZW50IHRvIHBvcHVwV2l0aEZvcm0pXG4gKi9cbmZ1bmN0aW9uIGhhbmRsZVByb2ZpbGVGb3JtU3VibWl0KCkge1xuICBhcGkuc2V0VXNlckluZm8oeyBuZXdOYW1lOiBuYW1lSW5wdXQudmFsdWUsIG5ld0Fib3V0OiBkZXNjcmlwdGlvbklucHV0LnZhbHVlIH0pXG4gIC50aGVuKCByZXMgPT4ge1xuICAgIHVzZXJJbmZvLnNldFVzZXJJbmZvKHJlcyk7XG4gIH0pXG59XG5cbi8qKlxuICogRGVsZXRlcyB0aGUgc2VsZWN0ZWQgQ2FyZFxuICovXG5mdW5jdGlvbiBoYW5kbGVEZWxldGVGb3JtU3VibWl0KCkge1xuICBhcGkuZGVsZXRlQ2FyZChjYXJkVG9EZWxldGUuZ2V0SWQoKSlcbiAgICAudGhlbigoKSA9PiB7XG4gICAgICBjb25zb2xlLmxvZyhcIkNhcmQgZGVsZXRlZFwiKTtcbiAgICAgIGNhcmRUb0RlbGV0ZS5kZWxldGVDYXJkKCk7XG4gICAgICBjYXJkVG9EZWxldGU9bnVsbDtcbiAgICB9KVxufVxuXG4vKipcbiAqIEhhbmRsZXMgb3BlbiBwaG90byBvbiBjYXJkIGNsaWNrIChzZW50IHRvIHBvcHVwV2l0aENhcmQpXG4gKi9cbmZ1bmN0aW9uIGhhbmRsZUNhcmRDbGljaygpIHtcbiAgcGhvdG9Qb3B1cC5vcGVuKHRoaXMuX2ltYWdlLCB0aGlzLl9uYW1lKTtcbn1cblxuZnVuY3Rpb24gaGFuZGxlQ2FyZERlbGV0ZUNsaWNrKCkge1xuICBkZWxldGVQb3B1cC5vcGVuKCk7XG4gIGNhcmRUb0RlbGV0ZSA9IHRoaXM7XG59XG5cbi8qKlxuICogRW5hYmxlcyB2YWxpZGF0aW9uIG9uIGFsbCBmb3Jtcy5cbiAqIFNhdmVzIHRoZSBmb3JtVmFsaWRhdG9ycyBvbiBhIE1hcCBmb3IgZnV0dXJlIGFjY2Vzc1xuICovXG5mdW5jdGlvbiBlbmFibGVGb3JtVmFsaWRhdGlvbk9uQWxsRm9ybXMoKSB7XG4gIGNvbnN0IGZvcm1MaXN0ID0gQXJyYXkuZnJvbShkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKHZhbGlkYXRpb25Db25maWcuZm9ybVNlbGVjdG9yKSk7XG4gIGZvcm1MaXN0LmZvckVhY2goKGZvcm1FbGVtZW50KSA9PiB7XG4gICAgY29uc3QgZm9ybU5hbWUgPSBmb3JtRWxlbWVudC5nZXRBdHRyaWJ1dGUoXCJuYW1lXCIpO1xuICAgIGNvbnN0IGZvcm1WYWxpZGF0b3IgPSBuZXcgRm9ybVZhbGlkYXRvcih2YWxpZGF0aW9uQ29uZmlnLCBmb3JtRWxlbWVudCk7XG4gICAgZm9ybVZhbGlkYXRvci5lbmFibGVWYWxpZGF0aW9uKCk7XG4gICAgZm9ybXMuc2V0KGZvcm1OYW1lLCBmb3JtVmFsaWRhdG9yKTtcbiAgfSk7XG59XG5cbi8qKlxuICogU2V0dGluZyB1cCB0aGUgQXBpIGNsYXNzXG4gKi9cbmNvbnN0IGFwaSA9IG5ldyBBcGkoe1xuICBiYXNlVXJsOiBcImh0dHBzOi8vYXJvdW5kLm5vbW9yZXBhcnRpZXMuY28vdjEvZ3JvdXAtMTJcIixcbiAgaGVhZGVyczoge1xuICAgIGF1dGhvcml6YXRpb246IFwiYjlkMWMzYjYtYzBmNC00MjI0LWFkOGYtNGM4MWVmYTNmODlkXCIsXG4gICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCJcbiAgfVxufSk7XG5cbmNvbnN0IHVzZXJJbmZvID0gbmV3IFVzZXJJbmZvKHVzZXJTZWxlY3RvcnMpO1xuXG4vKiogVXNlciBpbmZvcm1hdGlvbiBsb2FkaW5nICovXG5hcGkuZ2V0VXNlckluZm8oKVxuICAudGhlbihyZXMgPT4ge1xuICAgIHVzZXJJbmZvLnNldFVzZXJJbmZvKHJlcyk7XG4gIH0pXG5cbi8qKlxuICogTG9hZGluZyBjYXJkcyB3aXRoIFNlY3Rpb25cbiAqL1xuXG5sZXQgc2VjdGlvbjtcblxuYXBpLmdldEluaXRpYWxDYXJkcygpXG4gIC50aGVuKHJlcyA9PiB7XG4gICAgc2VjdGlvbiA9IG5ldyBTZWN0aW9uKCB7XG4gICAgICBpdGVtczogcmVzLFxuICAgICAgcmVuZGVyZXI6IHJlbmRlckNhcmRcbiAgICB9LFxuICAgIHBob3RvR3JpZFNlbGVjdG9yKTtcblxuICAgIHNlY3Rpb24ucmVuZGVyZXIoKTtcbiAgfSk7XG5cbi8qKiBQb3B1cCBsb2FkaW5nIGFuZCBldmVudCBsaXN0ZW5lciBzZXR1cCAqL1xuY29uc3QgYWRkUG9wdXAgPSBuZXcgUG9wdXBXaXRoRm9ybSgnLnBvcHVwLWFkZCcsIGhhbmRsZU5ld1BsYWNlRm9ybVN1Ym1pdCk7XG5jb25zdCBlZGl0UG9wdXAgPSBuZXcgUG9wdXBXaXRoRm9ybSgnLnBvcHVwLWVkaXQnLCBoYW5kbGVQcm9maWxlRm9ybVN1Ym1pdCk7XG5jb25zdCBkZWxldGVQb3B1cCA9IG5ldyBQb3B1cFdpdGhGb3JtKCcucG9wdXAtZGVsZXRlJywgaGFuZGxlRGVsZXRlRm9ybVN1Ym1pdClcbmNvbnN0IHBob3RvUG9wdXAgPSBuZXcgUG9wdXBXaXRoSW1hZ2UoJy5wb3B1cC1waG90bycpO1xuXG4vKiogRW5hYmxlIFZhbGlkYXRpb24gKi9cbmVuYWJsZUZvcm1WYWxpZGF0aW9uT25BbGxGb3JtcygpO1xuXG5cbi8qKiBEZWNsYXJhdGlvbiBvZiB0aGUgZXZlbnQgbGlzdGVuZXJzICovXG5cbi8qKiBBZGQgUG9wdXAgYW5kIEZvcm0gKi9cbmFkZEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICBhZGRQb3B1cC5vcGVuKCk7XG4gIGZvcm1zLmdldChmb3JtQWRkTmFtZSkucmVzZXRWYWxpZGF0aW9uKCk7XG59KTtcblxuY2xvc2VCdXR0b25BZGQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgYWRkUG9wdXAuY2xvc2UoKTtcbn0pO1xuXG5cbi8qKiBFZGl0IFBvcHVwIGFuZCBGb3JtICovXG5lZGl0QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gIGNvbnN0IGN1cnJlbnRVc2VySW5mbyA9IHVzZXJJbmZvLmdldFVzZXJJbmZvKCk7XG4gIG5hbWVJbnB1dC52YWx1ZSA9IGN1cnJlbnRVc2VySW5mby5uYW1lO1xuICBkZXNjcmlwdGlvbklucHV0LnZhbHVlID0gY3VycmVudFVzZXJJbmZvLmpvYjtcbiAgZWRpdFBvcHVwLm9wZW4oKTtcbiAgZm9ybXMuZ2V0KGZvcm1FZGl0TmFtZSkucmVzZXRWYWxpZGF0aW9uKCk7XG59KTtcblxuY2xvc2VCdXR0b25FZGl0LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gIGVkaXRQb3B1cC5jbG9zZSgpO1xufSk7XG5cbi8qKiBQaG90byBwb3B1cCAqL1xuXG5jbG9zZUJ1dHRvblBob3RvLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gIHBob3RvUG9wdXAuY2xvc2UoKTtcbn0pO1xuXG5cblxuXG5cbiIsImNsYXNzIEFwaSB7XG4gICAgY29uc3RydWN0b3Iob3B0aW9ucykge1xuICAgICAgICB0aGlzLl9vcHRpb25zID0gb3B0aW9ucztcbiAgICB9XG5cbiAgICBnZXRJbml0aWFsQ2FyZHMoKSB7XG4gICAgICAgIHJldHVybiBmZXRjaCh0aGlzLl9vcHRpb25zLmJhc2VVcmwrXCIvY2FyZHMvXCIsIHtcbiAgICAgICAgICAgIGhlYWRlcnM6IHRoaXMuX29wdGlvbnMuaGVhZGVyc1xuICAgICAgICAgIH0pXG4gICAgICAgICAgLnRoZW4ocmVzID0+IHtcbiAgICAgICAgICAgIGlmIChyZXMub2spIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSlcbiAgICAgICAgICAudGhlbiggcmVzID0+IHtcbiAgICAgICAgICAgIHJldHVybiByZXM7XG4gICAgICAgICAgfSlcbiAgICAgICAgICAuY2F0Y2goIGVyciA9PiB7XG4gICAgICAgICAgICAvLyBpZiB0aGUgc2VydmVyIHJldHVybnMgYW4gZXJyb3IsIHJlamVjdCB0aGUgcHJvbWlzZVxuICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtlcnIuc3RhdHVzfWApO1xuICAgICAgICAgIH0pXG4gICAgICAgICAgLmZpbmFsbHkgKCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIkFsbCBkb25lXCIpO1xuICAgICAgICAgIH0pXG5cbiAgICB9XG5cbiAgICBzZXROZXdDYXJkKCB7IGNhcmROYW1lLCBjYXJkTGluayB9KSB7XG4gICAgICByZXR1cm4gZmV0Y2godGhpcy5fb3B0aW9ucy5iYXNlVXJsK1wiL2NhcmRzL1wiLCB7XG4gICAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICAgIGhlYWRlcnM6IHRoaXMuX29wdGlvbnMuaGVhZGVycyxcbiAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgIG5hbWU6IGNhcmROYW1lLFxuICAgICAgICAgIGxpbms6IGNhcmRMaW5rXG4gICAgICAgIH0pXG4gICAgICB9KVxuICAgICAgLnRoZW4ocmVzID0+IHtcbiAgICAgICAgaWYgKHJlcy5vaykge1xuICAgICAgICAgIHJldHVybiByZXMuanNvbigpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICAgIC50aGVuKCByZXMgPT4ge1xuICAgICAgICByZXR1cm4gcmVzO1xuICAgICAgfSlcbiAgICAgIC5jYXRjaCggZXJyID0+IHtcbiAgICAgICAgLy8gaWYgdGhlIHNlcnZlciByZXR1cm5zIGFuIGVycm9yLCByZWplY3QgdGhlIHByb21pc2VcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtlcnIuc3RhdHVzfWApO1xuICAgICAgfSlcbiAgICAgIC5maW5hbGx5ICggKCkgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZyhcIkFsbCBkb25lXCIpO1xuICAgICAgfSlcbiAgICB9XG5cbiAgICBhZGRMaWtlKGlkKSB7XG4gICAgICByZXR1cm4gZmV0Y2godGhpcy5fb3B0aW9ucy5iYXNlVXJsK1wiL2NhcmRzL2xpa2VzL1wiK2lkLCB7XG4gICAgICAgIG1ldGhvZDogXCJQVVRcIixcbiAgICAgICAgaGVhZGVyczogdGhpcy5fb3B0aW9ucy5oZWFkZXJzXG4gICAgICB9KVxuICAgICAgLnRoZW4ocmVzID0+IHtcbiAgICAgICAgaWYgKHJlcy5vaykge1xuICAgICAgICAgIHJldHVybiByZXMuanNvbigpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICAgIC50aGVuKCByZXMgPT4ge1xuICAgICAgICByZXR1cm4gcmVzO1xuICAgICAgfSlcbiAgICAgIC5jYXRjaCggZXJyID0+IHtcbiAgICAgICAgLy8gaWYgdGhlIHNlcnZlciByZXR1cm5zIGFuIGVycm9yLCByZWplY3QgdGhlIHByb21pc2VcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtlcnIuc3RhdHVzfWApO1xuICAgICAgfSlcbiAgICAgIC5maW5hbGx5ICggKCkgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZyhcIkFsbCBkb25lXCIpO1xuICAgICAgfSlcbiAgICB9XG5cbiAgICByZW1vdmVMaWtlKGlkKSB7XG4gICAgICByZXR1cm4gZmV0Y2godGhpcy5fb3B0aW9ucy5iYXNlVXJsK1wiL2NhcmRzL2xpa2VzL1wiK2lkLCB7XG4gICAgICAgIG1ldGhvZDogXCJERUxFVEVcIixcbiAgICAgICAgaGVhZGVyczogdGhpcy5fb3B0aW9ucy5oZWFkZXJzXG4gICAgICB9KVxuICAgICAgLnRoZW4ocmVzID0+IHtcbiAgICAgICAgaWYgKHJlcy5vaykge1xuICAgICAgICAgIHJldHVybiByZXMuanNvbigpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICAgIC50aGVuKCByZXMgPT4ge1xuICAgICAgICByZXR1cm4gcmVzO1xuICAgICAgfSlcbiAgICAgIC5jYXRjaCggZXJyID0+IHtcbiAgICAgICAgLy8gaWYgdGhlIHNlcnZlciByZXR1cm5zIGFuIGVycm9yLCByZWplY3QgdGhlIHByb21pc2VcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtlcnIuc3RhdHVzfWApO1xuICAgICAgfSlcbiAgICAgIC5maW5hbGx5ICggKCkgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZyhcIkFsbCBkb25lXCIpO1xuICAgICAgfSlcbiAgICB9XG5cbiAgICBkZWxldGVDYXJkKGlkKSB7XG4gICAgICByZXR1cm4gZmV0Y2godGhpcy5fb3B0aW9ucy5iYXNlVXJsK1wiL2NhcmRzL1wiK2lkLCB7XG4gICAgICAgIG1ldGhvZDogXCJERUxFVEVcIixcbiAgICAgICAgaGVhZGVyczogdGhpcy5fb3B0aW9ucy5oZWFkZXJzXG4gICAgICB9KVxuICAgICAgLnRoZW4ocmVzID0+IHtcbiAgICAgICAgaWYgKHJlcy5vaykge1xuICAgICAgICAgIHJldHVybiByZXMuanNvbigpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICAgIC50aGVuKCByZXMgPT4ge1xuICAgICAgICByZXR1cm4gcmVzO1xuICAgICAgfSlcbiAgICAgIC5jYXRjaCggZXJyID0+IHtcbiAgICAgICAgLy8gaWYgdGhlIHNlcnZlciByZXR1cm5zIGFuIGVycm9yLCByZWplY3QgdGhlIHByb21pc2VcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtlcnIuc3RhdHVzfWApO1xuICAgICAgfSlcbiAgICAgIC5maW5hbGx5ICggKCkgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZyhcIkFsbCBkb25lXCIpO1xuICAgICAgfSlcbiAgICB9XG5cbiAgICBnZXRVc2VySW5mbygpIHtcbiAgICAgIHJldHVybiBmZXRjaCh0aGlzLl9vcHRpb25zLmJhc2VVcmwrXCIvdXNlcnMvbWVcIiwge1xuICAgICAgICBoZWFkZXJzOiB0aGlzLl9vcHRpb25zLmhlYWRlcnNcbiAgICAgIH0pXG4gICAgICAudGhlbihyZXMgPT4ge1xuICAgICAgICBpZiAocmVzLm9rKSB7XG4gICAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXMuc3RhdHVzfWApO1xuICAgICAgICB9XG4gICAgICB9KVxuICAgICAgLnRoZW4oIHJlcyA9PiB7XG4gICAgICAgIHJldHVybiByZXM7XG4gICAgICB9KVxuICAgICAgLmNhdGNoKCBlcnIgPT4ge1xuICAgICAgICAvLyBpZiB0aGUgc2VydmVyIHJldHVybnMgYW4gZXJyb3IsIHJlamVjdCB0aGUgcHJvbWlzZVxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke2Vyci5zdGF0dXN9YCk7XG4gICAgICB9KVxuICAgICAgLmZpbmFsbHkgKCAoKSA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiQWxsIGRvbmVcIik7XG4gICAgICB9KVxuXG4gICAgfVxuXG4gICAgc2V0VXNlckluZm8oIHsgbmV3TmFtZSwgbmV3QWJvdXQgfSkge1xuICAgICAgcmV0dXJuIGZldGNoKHRoaXMuX29wdGlvbnMuYmFzZVVybCtcIi91c2Vycy9tZVwiLCB7XG4gICAgICAgIG1ldGhvZDogXCJQQVRDSFwiLFxuICAgICAgICBoZWFkZXJzOiB0aGlzLl9vcHRpb25zLmhlYWRlcnMsXG4gICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICBuYW1lOiBuZXdOYW1lLFxuICAgICAgICAgIGFib3V0OiBuZXdBYm91dFxuICAgICAgICB9KVxuICAgICAgfSlcbiAgICAgIC50aGVuKHJlcyA9PiB7XG4gICAgICAgIGlmIChyZXMub2spIHtcbiAgICAgICAgICByZXR1cm4gcmVzLmpzb24oKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgICAudGhlbiggcmVzID0+IHtcbiAgICAgICAgcmV0dXJuIHJlcztcbiAgICAgIH0pXG4gICAgICAuY2F0Y2goIGVyciA9PiB7XG4gICAgICAgIC8vIGlmIHRoZSBzZXJ2ZXIgcmV0dXJucyBhbiBlcnJvciwgcmVqZWN0IHRoZSBwcm9taXNlXG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7ZXJyLnN0YXR1c31gKTtcbiAgICAgIH0pXG4gICAgICAuZmluYWxseSAoICgpID0+IHtcbiAgICAgICAgY29uc29sZS5sb2coXCJBbGwgZG9uZVwiKTtcbiAgICAgIH0pXG5cbiAgICB9XG5cbiAgICB1cGRhdGVBdmF0YXIobGluaykge1xuICAgICAgcmV0dXJuIGZldGNoKHRoaXMuX29wdGlvbnMuYmFzZVVybCtcIi91c2Vycy9tZS9hdmF0YXJcIiwge1xuICAgICAgICBtZXRob2Q6IFwiUEFUQ0hcIixcbiAgICAgICAgaGVhZGVyczogdGhpcy5fb3B0aW9ucy5oZWFkZXJzLFxuICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgYXZhdGFyOiBsaW5rXG4gICAgICAgIH0pXG4gICAgICB9KVxuICAgICAgLnRoZW4ocmVzID0+IHtcbiAgICAgICAgaWYgKHJlcy5vaykge1xuICAgICAgICAgIHJldHVybiByZXMuanNvbigpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICAgIC50aGVuKCByZXMgPT4ge1xuICAgICAgICByZXR1cm4gcmVzO1xuICAgICAgfSlcbiAgICAgIC5jYXRjaCggZXJyID0+IHtcbiAgICAgICAgLy8gaWYgdGhlIHNlcnZlciByZXR1cm5zIGFuIGVycm9yLCByZWplY3QgdGhlIHByb21pc2VcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtlcnIuc3RhdHVzfWApO1xuICAgICAgfSlcbiAgICAgIC5maW5hbGx5ICggKCkgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZyhcIkFsbCBkb25lXCIpO1xuICAgICAgfSlcblxuICAgIH1cbiAgICBcbn1cblxuZXhwb3J0IHsgQXBpIH07XG4iLCJjbGFzcyBVc2VySW5mbyB7XG4gICAgY29uc3RydWN0b3IoeyBuYW1lU2VsZWN0b3IsIGpvYlNlbGVjdG9yIH0pIHtcbiAgICAgICAgdGhpcy5fbmFtZVNlbGVjdG9yID0gbmFtZVNlbGVjdG9yO1xuICAgICAgICB0aGlzLl9qb2JTZWxlY3RvciA9IGpvYlNlbGVjdG9yO1xuICAgIH1cblxuICAgIGdldFVzZXJJbmZvKCkge1xuICAgICAgICByZXR1cm4geyBcbiAgICAgICAgICAgIG5hbWU6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IodGhpcy5fbmFtZVNlbGVjdG9yKS50ZXh0Q29udGVudCxcbiAgICAgICAgICAgIGpvYjogZG9jdW1lbnQucXVlcnlTZWxlY3Rvcih0aGlzLl9qb2JTZWxlY3RvcikudGV4dENvbnRlbnRcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICBzZXRVc2VySW5mbyggeyBuYW1lLCBhYm91dCB9ICkge1xuICAgICAgICBjb25zdCBuYW1lRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IodGhpcy5fbmFtZVNlbGVjdG9yKTtcbiAgICAgICAgY29uc3Qgam9iRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IodGhpcy5fam9iU2VsZWN0b3IpO1xuXG4gICAgICAgIG5hbWVFbGVtZW50LnRleHRDb250ZW50ID0gbmFtZTtcbiAgICAgICAgam9iRWxlbWVudC50ZXh0Q29udGVudCA9IGFib3V0O1xuICAgIH1cbn1cblxuZXhwb3J0IHsgVXNlckluZm8gfTsiLCJpbXBvcnQgeyBQb3B1cCB9IGZyb20gXCIuL1BvcHVwLmpzXCI7XG5cbmNsYXNzIFBvcHVwV2l0aEltYWdlIGV4dGVuZHMgUG9wdXAge1xuICAgIGNvbnN0cnVjdG9yKHBvcHVwU2VsZWN0b3IpIHtcbiAgICAgICAgc3VwZXIocG9wdXBTZWxlY3Rvcik7XG4gICAgfVxuXG4gICAgb3BlbihwaG90b0ltYWdlLCBuYW1lKSB7XG4gICAgICAgIGNvbnN0IHBob3RvQ29udGFpbmVyID0gdGhpcy5fcG9wdXAucXVlcnlTZWxlY3RvcignLnBvcHVwLXBob3RvX19jb250YWluZXInKTtcbiAgICAgICAgY29uc3QgcGhvdG8gPSBwaG90b0NvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCcucG9wdXAtcGhvdG9fX3Bob3RvJyk7XG4gICAgICAgIGNvbnN0IHRpdGxlID0gcGhvdG9Db250YWluZXIucXVlcnlTZWxlY3RvcignLnBvcHVwLXBob3RvX190aXRsZScpO1xuXG4gICAgICAgIHBob3RvLnNyYyA9IHBob3RvSW1hZ2U7XG4gICAgICAgIHRpdGxlLnRleHRDb250ZW50ID0gbmFtZTtcbiAgICAgICAgcGhvdG8uYWx0ID0gbmFtZTtcbiAgICAgICAgc3VwZXIub3BlbigpO1xuICAgIH1cbn1cblxuZXhwb3J0IHsgUG9wdXBXaXRoSW1hZ2UgfTsiXSwibmFtZXMiOlsiRm9ybVZhbGlkYXRvciIsImNvbnN0cnVjdG9yIiwic2V0dGluZ3MiLCJmb3JtIiwidGhpcyIsIl9zZXR0aW5ncyIsIl9mb3JtIiwiX3Nob3dJbnB1dEVycm9yIiwiaW5wdXRFbGVtZW50IiwiZXJyb3JNZXNzYWdlIiwiZXJyb3JFbGVtZW50IiwicXVlcnlTZWxlY3RvciIsImlkIiwiY2xhc3NMaXN0IiwiYWRkIiwiaW5wdXRFcnJvckNsYXNzIiwidGV4dENvbnRlbnQiLCJlcnJvckNsYXNzIiwiX2hpZGVJbnB1dEVycm9yIiwicmVtb3ZlIiwiX2NoZWNrSW5wdXRWYWxpZGl0eSIsInZhbGlkaXR5IiwidmFsaWQiLCJ2YWxpZGF0aW9uTWVzc2FnZSIsIl9oYXNJbnZhbGlkSW5wdXQiLCJfaW5wdXRMaXN0Iiwic29tZSIsIl90b2dnbGVCdXR0b25TdGF0ZSIsIl9idXR0b25FbGVtZW50IiwiaW5hY3RpdmVCdXR0b25DbGFzcyIsInNldEF0dHJpYnV0ZSIsInJlbW92ZUF0dHJpYnV0ZSIsIl9zZXRFdmVudExpc3RlbmVycyIsIkFycmF5IiwiZnJvbSIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJpbnB1dFNlbGVjdG9yIiwic3VibWl0QnV0dG9uU2VsZWN0b3IiLCJmb3JFYWNoIiwiYWRkRXZlbnRMaXN0ZW5lciIsInJlc2V0VmFsaWRhdGlvbiIsImVuYWJsZVZhbGlkYXRpb24iLCJldnQiLCJwcmV2ZW50RGVmYXVsdCIsImRvY3VtZW50IiwiQ2FyZCIsImNhcmRTZWxlY3RvciIsImhhbmRsZUNhcmRDbGljayIsImhhbmRsZURlbGV0ZUNhcmRDbGljayIsImhhbmRsZUNhcmREZWxldGVTdWJtaXQiLCJfaWQiLCJuYW1lIiwibGluayIsIl9lbGVtZW50IiwidG9nZ2xlIiwiX2hhbmRsZURlbGV0ZUNhcmRDbGljayIsIl9uYW1lIiwiX2ltYWdlIiwiX2NhcmRTZWxlY3RvciIsIl9oYW5kbGVDYXJkQ2xpY2siLCJnZXRJZCIsImNyZWF0ZUNhcmQiLCJfY3JlYXRlTmV3UGhvdG9DYXJkRWxlbWVudCIsIl9hZGRFdmVudExpc3RlbmVycyIsImRlbGV0ZUNhcmQiLCJsaWtlQnV0dG9uIiwiX2FkZExpa2VFdmVudExpc3RlbmVyIiwiZGVsZXRlQnV0dG9uIiwiX2FkZERlbGV0ZUV2ZW50TGlzdGVuZXIiLCJwaG90byIsIl9hZGRPcGVuUGhvdG9FdmVudExpc3RlbmVyIiwicGhvdG9DYXJkIiwiY2xvbmVOb2RlIiwicGhvdG9UaXRsZSIsInNyYyIsImFsdCIsIl9oYW5kbGVMaWtlRXZlbnQiLCJfaGFuZGxlRGVsZXRlRXZlbnQiLCJQb3B1cCIsInBvcHVwU2VsZWN0b3IiLCJrZXkiLCJfcG9wdXAiLCJjb250YWlucyIsImNsb3NlIiwidGFyZ2V0Iiwib3BlbiIsInNldEV2ZW50TGlzdGVuZXJzIiwicmVtb3ZlRXZlbnRMaXN0ZW5lcnMiLCJfaGFuZGxlQ2xpY2tPbk92ZXJsYXlDbG9zZSIsIl9oYW5kbGVFc2NDbG9zZSIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJQb3B1cFdpdGhGb3JtIiwiaGFuZGxlU3VibWl0Iiwic3VwZXIiLCJfaGFuZGxlU3VibWl0IiwiX2dldElucHV0VmFsdWVzIiwiaW5wdXRWYWx1ZXMiLCJpbnB1dCIsImdldEF0dHJpYnV0ZSIsInZhbHVlIiwiX2hhbmRsZVByb2ZpbGVGb3JtU3VibWl0IiwicmVzZXQiLCJTZWN0aW9uIiwiY29udGFpbmVyU2VsZWN0b3IiLCJpdGVtcyIsInJlbmRlcmVyIiwiX2l0ZW1zIiwiX3JlbmRlcmVyIiwiX2NvbnRhaW5lciIsImNsZWFyIiwiaW5uZXJIVE1MIiwiaXRlbSIsImFkZEl0ZW0iLCJwcmVwZW5kIiwicG9wdXBFZGl0IiwicG9wdXBBZGQiLCJwb3B1cFBob3RvIiwicG9wdXBEZWxldGUiLCJjbG9zZUJ1dHRvbkVkaXQiLCJjbG9zZUJ1dHRvbkFkZCIsImNsb3NlQnV0dG9uUGhvdG8iLCJmb3JtRWRpdCIsIm5hbWVJbnB1dCIsImRlc2NyaXB0aW9uSW5wdXQiLCJmb3JtQWRkIiwidGl0bGVJbnB1dCIsImxpbmtJbnB1dCIsInByb2ZpbGUiLCJlZGl0QnV0dG9uIiwiYWRkQnV0dG9uIiwicGhvdG9DYXJkVGVtcGxhdGUiLCJjb250ZW50IiwiZm9ybXMiLCJNYXAiLCJjYXJkVG9EZWxldGUiLCJ2YWxpZGF0aW9uQ29uZmlnIiwiZm9ybVNlbGVjdG9yIiwicmVuZGVyQ2FyZCIsImNhcmQiLCJoYW5kbGVDYXJkRGVsZXRlQ2xpY2siLCJwaG90b1BvcHVwIiwiZGVsZXRlUG9wdXAiLCJhcGkiLCJvcHRpb25zIiwiX29wdGlvbnMiLCJnZXRJbml0aWFsQ2FyZHMiLCJmZXRjaCIsImJhc2VVcmwiLCJoZWFkZXJzIiwidGhlbiIsInJlcyIsIm9rIiwianNvbiIsIlByb21pc2UiLCJyZWplY3QiLCJzdGF0dXMiLCJjYXRjaCIsImVyciIsImZpbmFsbHkiLCJjb25zb2xlIiwibG9nIiwic2V0TmV3Q2FyZCIsImNhcmROYW1lIiwiY2FyZExpbmsiLCJtZXRob2QiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsImFkZExpa2UiLCJyZW1vdmVMaWtlIiwiZ2V0VXNlckluZm8iLCJzZXRVc2VySW5mbyIsIm5ld05hbWUiLCJuZXdBYm91dCIsImFib3V0IiwidXBkYXRlQXZhdGFyIiwiYXZhdGFyIiwiYXV0aG9yaXphdGlvbiIsInVzZXJJbmZvIiwibmFtZVNlbGVjdG9yIiwiam9iU2VsZWN0b3IiLCJfbmFtZVNlbGVjdG9yIiwiX2pvYlNlbGVjdG9yIiwiam9iIiwibmFtZUVsZW1lbnQiLCJqb2JFbGVtZW50Iiwic2VjdGlvbiIsImFkZFBvcHVwIiwibmV3Q2FyZCIsImVkaXRQb3B1cCIsInBob3RvSW1hZ2UiLCJwaG90b0NvbnRhaW5lciIsInRpdGxlIiwiZm9ybUVsZW1lbnQiLCJmb3JtTmFtZSIsImZvcm1WYWxpZGF0b3IiLCJzZXQiLCJnZXQiLCJjdXJyZW50VXNlckluZm8iXSwic291cmNlUm9vdCI6IiJ9