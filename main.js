!function(){"use strict";class e{constructor(e,t){this._settings=e,this._form=t}_showInputError(e,t){const o=this._form.querySelector(".".concat(e.id,"-error"));e.classList.add(this._settings.inputErrorClass),o.textContent=t,o.classList.add(this._settings.errorClass)}_hideInputError(e){const t=this._form.querySelector(".".concat(e.id,"-error"));e.classList.remove(this._settings.inputErrorClass),t.classList.remove(this._settings.errorClass),t.textContent=""}_checkInputValidity(e){e.validity.valid?this._hideInputError(e):this._showInputError(e,e.validationMessage)}_hasInvalidInput(){return this._inputList.some((e=>!e.validity.valid))}_toggleButtonState(){this._hasInvalidInput()?(this._buttonElement.classList.add(this._settings.inactiveButtonClass),this._buttonElement.setAttribute("disabled",!0)):(this._buttonElement.classList.remove(this._settings.inactiveButtonClass),this._buttonElement.removeAttribute("disabled"))}_setEventListeners(){this._inputList=Array.from(this._form.querySelectorAll(this._settings.inputSelector)),this._buttonElement=this._form.querySelector(this._settings.submitButtonSelector),this._toggleButtonState(),this._inputList.forEach((e=>{e.addEventListener("input",(()=>{this._checkInputValidity(e),this._toggleButtonState()}))}))}resetValidation(){this._inputList.forEach((e=>{this._hideInputError(e),this._toggleButtonState()}))}enableValidation(){this._setEventListeners(this._form),this._form.addEventListener("submit",(function(e){e.preventDefault()}))}}function t(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}document.querySelector(".popup-photo");class o{constructor(e,o,s,n,r){let{_id:i,name:a,link:l,likes:c}=e;t(this,"_handleLikeEvent",(()=>{this._element.querySelector(".photo-card__like-button").classList.contains("photo-card__like-button_active")?this._handleLikeClick(this,!1):this._handleLikeClick(this,!0)})),t(this,"_handleDeleteEvent",(()=>{this._handleDeleteCardClick(this)})),this._id=i,this._name=a,this._image=l,this._likes=c,this._cardSelector=o,this._handleCardClick=s,this._handleDeleteCardClick=n,this._handleLikeClick=r}getId(){return this._id}getName(){return this._name}getImageLink(){return this._image}createCard(){return this._element=this._createNewPhotoCardElement(),this._addEventListeners(),this._element}deleteCard(){this._element.remove(),this._element=null}updateLikes(e,t){this._likes=e;const o=this._element.querySelector(".photo-card__like-button");this._element.querySelector(".photo-card__like-count").textContent=this._likes.length,JSON.stringify(this._likes).includes(t)?o.classList.add("photo-card__like-button_active"):o.classList.remove("photo-card__like-button_active")}_addEventListeners(){const e=this._element.querySelector(".photo-card__like-button");this._addLikeEventListener(e);const t=this._element.querySelector(".photo-card__delete-button");this._addDeleteEventListener(t);const o=this._element.querySelector(".photo-card__photo");this._addOpenPhotoEventListener(o)}_createNewPhotoCardElement(){const e=this._cardSelector.querySelector(".photo-card").cloneNode(!0),t=e.querySelector(".photo-card__photo"),o=e.querySelector(".photo-card__title"),s=e.querySelector(".photo-card__like-count");return t.src=this._image,t.alt=this._name,o.textContent=this._name,s.textContent=this._likes.length,e}_addLikeEventListener(e){e.addEventListener("click",this._handleLikeEvent)}_addDeleteEventListener(e){e.addEventListener("click",this._handleDeleteEvent)}_addOpenPhotoEventListener(e){e.addEventListener("click",(()=>{this._handleCardClick(this)}))}}function s(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}class n{constructor(e){s(this,"close",(()=>{this._popup.classList.remove("popup_opened"),this.removeEventListeners()})),s(this,"_handleEscClose",(e=>{"Escape"==e.key&&this._popup.classList.contains("popup_opened")&&this.close()})),s(this,"_handleClickOnOverlayClose",(e=>{e.target.classList.contains("popup")&&this.close()})),this._popup=document.querySelector(e)}open(){this._popup.classList.add("popup_opened"),this.setEventListeners()}setEventListeners(){document.addEventListener("click",this._handleClickOnOverlayClose),document.addEventListener("keydown",this._handleEscClose),this._popup.querySelector(".popup__close-button").addEventListener("click",this.close)}removeEventListeners(){document.removeEventListener("click",this._handleClickOnOverlayClose),document.removeEventListener("keydown",this._handleEscClose),this._popup.querySelector(".popup__close-button").removeEventListener("click",close)}}class r extends n{constructor(e,t){var o,s;super(e),s=e=>{e.preventDefault(),this._handleSubmit(this,this._getInputValues())},(o="_handleProfileFormSubmit")in this?Object.defineProperty(this,o,{value:s,enumerable:!0,configurable:!0,writable:!0}):this[o]=s,this._handleSubmit=t,this._form=this._popup.querySelector(".form"),this._submitButton=this._popup.querySelector(".form__submit-button")}_getInputValues(){const e={};return Array.from(this._popup.querySelectorAll(".form__text-input")).forEach((t=>{e[t.getAttribute("name")]=t.value})),e}setButtonText(e){this._submitButton.textContent=e}setEventListeners(){this._form.addEventListener("submit",this._handleProfileFormSubmit),super.setEventListeners()}removeEventListeners(){this._form.removeEventListener("submit",this._handleProfileFormSubmit),super.removeEventListeners()}close(){this._form.reset(),super.close()}}class i{constructor(e,t){let{items:o,renderer:s}=e;this._items=o,this._renderer=s,this._container=document.querySelector(t)}clear(){this._container.innerHTML=""}renderer(){this.clear(),this._items.forEach((e=>{this.addItem(this._renderer(e))}))}addItem(e){this._container.prepend(e)}}const a=document.querySelector(".popup-edit"),l=document.querySelector(".popup-add"),c=document.querySelector(".popup-photo"),h=document.querySelector(".popup-delete"),u=document.querySelector(".popup-edit-avatar"),d=(a.querySelector(".popup__close-button"),l.querySelector(".popup__close-button"),c.querySelector(".popup__close-button"),h.querySelector(".popup__close-button"),u.querySelector(".popup__close-button"),a.querySelector(".form")),_=d.querySelector('.form__text-input[name="name"]'),p=d.querySelector('.form__text-input[name="about-me"]'),m=l.querySelector(".form"),v=(m.querySelector('.form__text-input[name="title"]'),m.querySelector('.form__text-input[name="image-link"]'),u.querySelector(".form").querySelector('.form__text-input[name="avatar-link"]'),document.querySelector(".profile")),f=v.querySelector(".profile__edit-button"),S=v.querySelector(".profile__add-button"),b=v.querySelector(".profile__photo-edit-button"),y=document.querySelector("#photo-card__template").content,k=new Map,g={formSelector:".form",inputSelector:".form__text-input",submitButtonSelector:".form__submit-button",inactiveButtonClass:"form__submit-button_disabled",inputErrorClass:"form__text-input-error_active",errorClass:"form__input-error_visible"};let L;function E(e){const t=new o(e,y,C,q,I),s=t.createCard();return t.updateLikes(t._likes,w._id),s}function C(e){O.open(e.getImageLink(),e.getName())}function q(e){T.open(),L=e}function I(e,t){t?x.addLike(e.getId()).then((t=>{console.log("Like added succesfully",t.likes),e.updateLikes(t.likes,w.getId())})).catch((e=>{console.log(e)})):x.removeLike(e.getId()).then((t=>{console.log("Like removed succesfully",t.likes),e.updateLikes(t.likes,w.getId())})).catch((e=>{console.log(e)}))}const x=new class{constructor(e){this._options=e}getInitialCards(){return fetch(this._options.baseUrl+"/cards/",{headers:this._options.headers}).then((e=>this._checkResponse(e))).then((e=>e))}setNewCard(e){let{cardName:t,cardLink:o}=e;return fetch(this._options.baseUrl+"/cards/",{method:"POST",headers:this._options.headers,body:JSON.stringify({name:t,link:o})}).then((e=>this._checkResponse(e))).then((e=>e))}addLike(e){return fetch(this._options.baseUrl+"/cards/likes/"+e,{method:"PUT",headers:this._options.headers}).then((e=>this._checkResponse(e))).then((e=>e))}removeLike(e){return fetch(this._options.baseUrl+"/cards/likes/"+e,{method:"DELETE",headers:this._options.headers}).then((e=>this._checkResponse(e))).then((e=>e))}deleteCard(e){return fetch(this._options.baseUrl+"/cards/"+e,{method:"DELETE",headers:this._options.headers}).then((e=>this._checkResponse(e))).then((e=>e))}getUserInfo(){return fetch(this._options.baseUrl+"/users/me",{headers:this._options.headers}).then((e=>this._checkResponse(e))).then((e=>e))}setUserInfo(e){let{newName:t,newAbout:o}=e;return fetch(this._options.baseUrl+"/users/me",{method:"PATCH",headers:this._options.headers,body:JSON.stringify({name:t,about:o})}).then((e=>this._checkResponse(e))).then((e=>e))}updateAvatar(e){return fetch(this._options.baseUrl+"/users/me/avatar",{method:"PATCH",headers:this._options.headers,body:JSON.stringify({avatar:e})}).then((e=>this._checkResponse(e))).then((e=>e))}_checkResponse(e){return e.ok?e.json():Promise.reject("Error: ".concat(e.status))}}({baseUrl:"https://around.nomoreparties.co/v1/group-12",headers:{authorization:"b9d1c3b6-c0f4-4224-ad8f-4c81efa3f89d","Content-Type":"application/json"}}),w=new class{constructor(e){let{nameSelector:t,jobSelector:o,avatarSelector:s}=e;this._nameSelector=t,this._jobSelector=o,this._avatarSelector=s}getId(){return this._id?this._id:null}getUserInfo(){return{name:document.querySelector(this._nameSelector).textContent,job:document.querySelector(this._jobSelector).textContent,avatar:document.querySelector(this._avatarSelector).src}}setUserInfo(e){let{name:t,about:o,_id:s,avatar:n}=e;const r=document.querySelector(this._nameSelector),i=document.querySelector(this._jobSelector),a=document.querySelector(this._avatarSelector);r.textContent=t,i.textContent=o,a.src=n,this._id=s}}({nameSelector:".profile__name",jobSelector:".profile__description",avatarSelector:".profile__photo"});let B;Promise.all([x.getUserInfo(),x.getInitialCards()]).then((e=>{let[t,o]=e;w.setUserInfo(t),B=new i({items:o,renderer:E},".photos__grid"),B.renderer()})).catch((e=>{console.log(e)}));const U=new r(".popup-add",(function(e,t){const o={cardName:t.title,cardLink:t["image-link"]};e.setButtonText("Saving..."),x.setNewCard(o).then((t=>{B.addItem(E(t)),e.close()})).catch((e=>{console.log(e)})).finally((()=>{e.setButtonText("Create")}))})),A=new r(".popup-edit",(function(e,t){e.setButtonText("Saving..."),x.setUserInfo({newName:t.name,newAbout:t["about-me"]}).then((t=>{w.setUserInfo(t),e.close()})).catch((e=>{console.log(e)})).finally((()=>{e.setButtonText("Save")}))})),T=new r(".popup-delete",(function(e){e.setButtonText("Deleting..."),x.deleteCard(L.getId()).then((()=>{L.deleteCard(),L=null,e.close()})).catch((e=>{console.log(e)})).finally((()=>{e.setButtonText("Yes")}))})),O=new class extends n{constructor(e){super(e)}open(e,t){const o=this._popup.querySelector(".popup-photo__container"),s=o.querySelector(".popup-photo__photo"),n=o.querySelector(".popup-photo__title");s.src=e,n.textContent=t,s.alt=t,super.open()}}(".popup-photo"),P=new r(".popup-edit-avatar",(function(e,t){e.setButtonText("Saving..."),x.updateAvatar(t["avatar-link"]).then((t=>{console.log("Avatar updated ",t),w.setUserInfo(t),e.close()})).catch((e=>{console.log(e)})).finally((()=>{e.setButtonText("Save")}))}));Array.from(document.querySelectorAll(g.formSelector)).forEach((t=>{const o=t.getAttribute("name"),s=new e(g,t);s.enableValidation(),k.set(o,s)})),S.addEventListener("click",(()=>{U.open(),k.get("add-form").resetValidation()})),f.addEventListener("click",(()=>{const e=w.getUserInfo();_.value=e.name,p.value=e.job,A.open(),k.get("edit-form").resetValidation()})),b.addEventListener("click",(()=>{P.open(),k.get("edit-avatar-form").resetValidation()}))}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LElBQ05ILFFBQVFDLElBQUlFLE1BRWI2QyxTQUFRLEtBQ1BILEVBQU05RixjQUFjLGNBK0NQL0UsTUFBTUMsS0FBS1UsU0FBU1QsaUJBQWlCb0gsRUFBQUEsZUFDN0NqSCxTQUFTaUwsSUFDaEIsTUFBTUMsRUFBV0QsRUFBWXpHLGFBQWEsUUFDcEMyRyxFQUFnQixJQUFJek4sRUFBY3VKLEVBQTRCZ0UsR0FDcEVFLEVBQWNoTCxtQkFDZDhHLEVBQUFBLElBQW9CaUUsRUFBVUMsTUFpRGxDbEUsRUFBQUEsaUJBQXFDLFNBQVMsS0FDNUNzRCxFQUFTNUcsT0FDVHNELEVBQUFBLElEOUt5QixZQzhLa0IvRyxxQkFLN0MrRyxFQUFBQSxpQkFBc0MsU0FBUyxLQUM3QyxNQUFNbUUsRUFBa0JqRSxFQUFTeUIsY0FDakMzQixFQUFBQSxNQUE0Qm1FLEVBQWdCdkssS0FDNUNvRyxFQUFBQSxNQUFtQ21FLEVBQWdCckIsSUFDbkRhLEVBQVVqSCxPQUNWc0QsRUFBQUEsSUR6TDBCLGFDeUxrQi9HLHFCQUs5QytHLEVBQUFBLGlCQUE0QyxTQUFTLEtBQ25EK0QsRUFBZ0JySCxPQUNoQnNELEVBQUFBLElEN0xnQyxvQkM2TGtCL0cscUIiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvRm9ybVZhbGlkYXRvci5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvQ2FyZC5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvUG9wdXAuanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL1BvcHVwV2l0aEZvcm0uanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL1NlY3Rpb24uanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy91dGlscy9jb25zdGFudHMuanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9wYWdlL2luZGV4LmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy9BcGkuanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL1VzZXJJbmZvLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy9Qb3B1cFdpdGhJbWFnZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjbGFzcyBGb3JtVmFsaWRhdG9yIHtcbiAgY29uc3RydWN0b3Ioc2V0dGluZ3MsIGZvcm0pe1xuICAgIHRoaXMuX3NldHRpbmdzID0gc2V0dGluZ3M7XG4gICAgdGhpcy5fZm9ybSA9IGZvcm07XG4gIH1cblxuICBfc2hvd0lucHV0RXJyb3IoaW5wdXRFbGVtZW50LCBlcnJvck1lc3NhZ2UpIHtcbiAgICBjb25zdCBlcnJvckVsZW1lbnQgPSB0aGlzLl9mb3JtLnF1ZXJ5U2VsZWN0b3IoYC4ke2lucHV0RWxlbWVudC5pZH0tZXJyb3JgKTtcbiAgICBpbnB1dEVsZW1lbnQuY2xhc3NMaXN0LmFkZCh0aGlzLl9zZXR0aW5ncy5pbnB1dEVycm9yQ2xhc3MpO1xuICAgIGVycm9yRWxlbWVudC50ZXh0Q29udGVudCA9IGVycm9yTWVzc2FnZTtcbiAgICBlcnJvckVsZW1lbnQuY2xhc3NMaXN0LmFkZCh0aGlzLl9zZXR0aW5ncy5lcnJvckNsYXNzKTtcbiAgfTtcblxuICBfaGlkZUlucHV0RXJyb3IoaW5wdXRFbGVtZW50KSB7XG4gICAgY29uc3QgZXJyb3JFbGVtZW50ID0gdGhpcy5fZm9ybS5xdWVyeVNlbGVjdG9yKGAuJHtpbnB1dEVsZW1lbnQuaWR9LWVycm9yYCk7XG4gICAgaW5wdXRFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUodGhpcy5fc2V0dGluZ3MuaW5wdXRFcnJvckNsYXNzKTtcbiAgICBlcnJvckVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSh0aGlzLl9zZXR0aW5ncy5lcnJvckNsYXNzKTtcbiAgICBlcnJvckVsZW1lbnQudGV4dENvbnRlbnQgPSBcIlwiO1xuICB9O1xuXG4gIF9jaGVja0lucHV0VmFsaWRpdHkoaW5wdXRFbGVtZW50KSB7XG4gICAgaWYgKCFpbnB1dEVsZW1lbnQudmFsaWRpdHkudmFsaWQpIHtcbiAgICAgIHRoaXMuX3Nob3dJbnB1dEVycm9yKGlucHV0RWxlbWVudCwgaW5wdXRFbGVtZW50LnZhbGlkYXRpb25NZXNzYWdlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5faGlkZUlucHV0RXJyb3IoaW5wdXRFbGVtZW50KTtcbiAgICB9XG4gIH07XG5cbiAgX2hhc0ludmFsaWRJbnB1dCgpIHtcbiAgICByZXR1cm4gdGhpcy5faW5wdXRMaXN0LnNvbWUoKGlucHV0RWxlbWVudCkgPT4ge1xuICAgICAgcmV0dXJuICFpbnB1dEVsZW1lbnQudmFsaWRpdHkudmFsaWQ7XG4gICAgfSk7XG4gIH07XG5cbiAgX3RvZ2dsZUJ1dHRvblN0YXRlKCkge1xuICAgIGlmICh0aGlzLl9oYXNJbnZhbGlkSW5wdXQoKSkge1xuICAgICAgdGhpcy5fYnV0dG9uRWxlbWVudC5jbGFzc0xpc3QuYWRkKHRoaXMuX3NldHRpbmdzLmluYWN0aXZlQnV0dG9uQ2xhc3MpO1xuICAgICAgdGhpcy5fYnV0dG9uRWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJkaXNhYmxlZFwiLCB0cnVlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5fYnV0dG9uRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuX3NldHRpbmdzLmluYWN0aXZlQnV0dG9uQ2xhc3MpO1xuICAgICAgdGhpcy5fYnV0dG9uRWxlbWVudC5yZW1vdmVBdHRyaWJ1dGUoXCJkaXNhYmxlZFwiKTtcbiAgICB9XG4gIH07XG5cbiAgX3NldEV2ZW50TGlzdGVuZXJzKCkge1xuICAgIHRoaXMuX2lucHV0TGlzdCA9IEFycmF5LmZyb20odGhpcy5fZm9ybS5xdWVyeVNlbGVjdG9yQWxsKHRoaXMuX3NldHRpbmdzLmlucHV0U2VsZWN0b3IpKTtcbiAgICB0aGlzLl9idXR0b25FbGVtZW50ID0gdGhpcy5fZm9ybS5xdWVyeVNlbGVjdG9yKHRoaXMuX3NldHRpbmdzLnN1Ym1pdEJ1dHRvblNlbGVjdG9yKTtcblxuICAgIHRoaXMuX3RvZ2dsZUJ1dHRvblN0YXRlKCk7XG5cbiAgICB0aGlzLl9pbnB1dExpc3QuZm9yRWFjaCgoaW5wdXRFbGVtZW50KSA9PiB7XG4gICAgICBpbnB1dEVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsICgpID0+IHtcbiAgICAgICAgdGhpcy5fY2hlY2tJbnB1dFZhbGlkaXR5KGlucHV0RWxlbWVudCk7XG4gICAgICAgIHRoaXMuX3RvZ2dsZUJ1dHRvblN0YXRlKCk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfTtcblxuICByZXNldFZhbGlkYXRpb24oKXtcbiAgICB0aGlzLl9pbnB1dExpc3QuZm9yRWFjaCgoaW5wdXRFbGVtZW50KSA9PiB7XG4gICAgICB0aGlzLl9oaWRlSW5wdXRFcnJvcihpbnB1dEVsZW1lbnQpO1xuICAgICAgdGhpcy5fdG9nZ2xlQnV0dG9uU3RhdGUoKTtcbiAgICB9KTtcbiAgfVxuXG4gIGVuYWJsZVZhbGlkYXRpb24oKSB7XG4gICAgdGhpcy5fc2V0RXZlbnRMaXN0ZW5lcnModGhpcy5fZm9ybSk7XG4gICAgdGhpcy5fZm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIGZ1bmN0aW9uIChldnQpIHtcbiAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIH0pO1xuICB9O1xufVxuXG5cbmV4cG9ydCB7Rm9ybVZhbGlkYXRvcn07XG4iLCJcbmNvbnN0IHBvcHVwUGhvdG8gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucG9wdXAtcGhvdG8nKTtcblxuXG5jbGFzcyBDYXJkIHtcblxuICAgIGNvbnN0cnVjdG9yKHsgX2lkLCBuYW1lLCBsaW5rLCBsaWtlcyB9LCBjYXJkU2VsZWN0b3IsIGhhbmRsZUNhcmRDbGljaywgaGFuZGxlRGVsZXRlQ2FyZENsaWNrLCBoYW5kbGVMaWtlQ2xpY2spIHtcblxuICAgICAgICB0aGlzLl9pZCA9IF9pZDtcbiAgICAgICAgdGhpcy5fbmFtZSA9IG5hbWU7XG4gICAgICAgIHRoaXMuX2ltYWdlID0gbGluaztcbiAgICAgICAgdGhpcy5fbGlrZXMgPSBsaWtlcztcbiAgICAgICAgdGhpcy5fY2FyZFNlbGVjdG9yID0gY2FyZFNlbGVjdG9yO1xuICAgICAgICB0aGlzLl9oYW5kbGVDYXJkQ2xpY2sgPSBoYW5kbGVDYXJkQ2xpY2s7XG4gICAgICAgIHRoaXMuX2hhbmRsZURlbGV0ZUNhcmRDbGljayA9IGhhbmRsZURlbGV0ZUNhcmRDbGljaztcbiAgICAgICAgdGhpcy5faGFuZGxlTGlrZUNsaWNrID0gaGFuZGxlTGlrZUNsaWNrO1xuICAgIH1cblxuICAgIGdldElkKCkge1xuICAgICAgcmV0dXJuIHRoaXMuX2lkO1xuICAgIH1cblxuICAgIGdldE5hbWUoKSB7XG4gICAgICByZXR1cm4gdGhpcy5fbmFtZTtcbiAgICB9XG5cbiAgICBnZXRJbWFnZUxpbmsoKSB7XG4gICAgICByZXR1cm4gdGhpcy5faW1hZ2U7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBvbmUgc2luZ2xlIHBob3RvIGNhcmQgd2l0aCBzcGVjaWZpZWQgY2FyZCBpbmZvcm1hdGlvbiAob2JqZWN0KVxuICAgICAqIEBwYXJhbSB7b2JqZWN0fSBjYXJkXG4gICAgICogQHJldHVybnMgcGhvdG9DYXJkIHRvIGJlIHJlbmRlcmVkXG4gICAgICovXG4gICAgY3JlYXRlQ2FyZCgpIHtcbiAgICAgIHRoaXMuX2VsZW1lbnQgPSB0aGlzLl9jcmVhdGVOZXdQaG90b0NhcmRFbGVtZW50KCk7XG4gICAgICB0aGlzLl9hZGRFdmVudExpc3RlbmVycygpO1xuXG4gICAgICByZXR1cm4gdGhpcy5fZWxlbWVudDtcbiAgICB9XG5cbiAgICBkZWxldGVDYXJkKCkge1xuICAgICAgdGhpcy5fZWxlbWVudC5yZW1vdmUoKTtcbiAgICAgIHRoaXMuX2VsZW1lbnQgPSBudWxsO1xuICAgIH1cblxuICAgIHVwZGF0ZUxpa2VzKGxpa2VzLCB1c2VySWQpIHtcbiAgICAgIHRoaXMuX2xpa2VzID0gbGlrZXM7XG4gICAgICBjb25zdCBsaWtlQnV0dG9uID0gdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLnBob3RvLWNhcmRfX2xpa2UtYnV0dG9uXCIpO1xuXG4gICAgICB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucGhvdG8tY2FyZF9fbGlrZS1jb3VudFwiKS50ZXh0Q29udGVudCA9IHRoaXMuX2xpa2VzLmxlbmd0aDtcblxuICAgICAgaWYoSlNPTi5zdHJpbmdpZnkodGhpcy5fbGlrZXMpLmluY2x1ZGVzKHVzZXJJZCkpIHtcbiAgICAgICAgbGlrZUJ1dHRvbi5jbGFzc0xpc3QuYWRkKCdwaG90by1jYXJkX19saWtlLWJ1dHRvbl9hY3RpdmUnKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGxpa2VCdXR0b24uY2xhc3NMaXN0LnJlbW92ZSgncGhvdG8tY2FyZF9fbGlrZS1idXR0b25fYWN0aXZlJyk7XG4gICAgICB9XG5cbiAgICB9XG5cbiAgICBfYWRkRXZlbnRMaXN0ZW5lcnMoKXtcblxuICAgICAgICBjb25zdCBsaWtlQnV0dG9uID0gdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLnBob3RvLWNhcmRfX2xpa2UtYnV0dG9uXCIpO1xuICAgICAgICB0aGlzLl9hZGRMaWtlRXZlbnRMaXN0ZW5lcihsaWtlQnV0dG9uKTtcblxuICAgICAgICBjb25zdCBkZWxldGVCdXR0b24gPSB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucGhvdG8tY2FyZF9fZGVsZXRlLWJ1dHRvblwiKTtcbiAgICAgICAgdGhpcy5fYWRkRGVsZXRlRXZlbnRMaXN0ZW5lcihkZWxldGVCdXR0b24pO1xuXG4gICAgICAgIGNvbnN0IHBob3RvID0gdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLnBob3RvLWNhcmRfX3Bob3RvXCIpO1xuICAgICAgICB0aGlzLl9hZGRPcGVuUGhvdG9FdmVudExpc3RlbmVyKHBob3RvKTtcbiAgICB9XG5cbiAgICBfY3JlYXRlTmV3UGhvdG9DYXJkRWxlbWVudCgpIHtcbiAgICAgICAgY29uc3QgcGhvdG9DYXJkID0gdGhpcy5fY2FyZFNlbGVjdG9yLnF1ZXJ5U2VsZWN0b3IoXCIucGhvdG8tY2FyZFwiKS5jbG9uZU5vZGUodHJ1ZSk7XG5cbiAgICAgICAgY29uc3QgcGhvdG8gPSBwaG90b0NhcmQucXVlcnlTZWxlY3RvcihcIi5waG90by1jYXJkX19waG90b1wiKTtcbiAgICAgICAgY29uc3QgcGhvdG9UaXRsZSA9IHBob3RvQ2FyZC5xdWVyeVNlbGVjdG9yKFwiLnBob3RvLWNhcmRfX3RpdGxlXCIpO1xuICAgICAgICBjb25zdCBwaG90b0xpa2VzID0gcGhvdG9DYXJkLnF1ZXJ5U2VsZWN0b3IoXCIucGhvdG8tY2FyZF9fbGlrZS1jb3VudFwiKTtcblxuICAgICAgICBwaG90by5zcmMgPSB0aGlzLl9pbWFnZTtcbiAgICAgICAgcGhvdG8uYWx0ID0gdGhpcy5fbmFtZTtcbiAgICAgICAgcGhvdG9UaXRsZS50ZXh0Q29udGVudCA9IHRoaXMuX25hbWU7XG4gICAgICAgIHBob3RvTGlrZXMudGV4dENvbnRlbnQgPSB0aGlzLl9saWtlcy5sZW5ndGg7XG5cbiAgICAgICAgcmV0dXJuIHBob3RvQ2FyZDtcbiAgICB9XG5cbiAgICAvKlxuICAgIEtlZXBpbmcgY29tbWVudCBmb3IgbGVhcm5pbmcgcHVycG9zZXNcbiAgICBkZWNsYXJlIG1ldGhvZHMgYXMgYXJyb3cgZnVuY3Rpb25zIHRvIG5vdCBsb3NlIGNvbnRleHQgYHRoaXNgLiBgdGhpc2AgaXMgQ2FyZCBpbnN0YW5jZSBoZXJlXG4gICAgKi9cbiAgICBfaGFuZGxlTGlrZUV2ZW50ID0gKCkgPT4ge1xuICAgICAgY29uc3QgbGlrZUJ1dHRvbiA9IHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5waG90by1jYXJkX19saWtlLWJ1dHRvblwiKTtcbiAgICAgIGlmKGxpa2VCdXR0b24uY2xhc3NMaXN0LmNvbnRhaW5zKCdwaG90by1jYXJkX19saWtlLWJ1dHRvbl9hY3RpdmUnKSkge1xuICAgICAgICB0aGlzLl9oYW5kbGVMaWtlQ2xpY2sodGhpcywgZmFsc2UpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5faGFuZGxlTGlrZUNsaWNrKHRoaXMsIHRydWUpO1xuICAgICAgfVxuICAgIH1cblxuICAgIF9hZGRMaWtlRXZlbnRMaXN0ZW5lcihsaWtlQnV0dG9uKSB7XG4gICAgICAgIGxpa2VCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHRoaXMuX2hhbmRsZUxpa2VFdmVudCk7XG4gICAgfVxuXG4gICAgX2hhbmRsZURlbGV0ZUV2ZW50ID0gKCkgPT4ge1xuICAgICAgdGhpcy5faGFuZGxlRGVsZXRlQ2FyZENsaWNrKHRoaXMpO1xuICAgIH1cblxuICAgIF9hZGREZWxldGVFdmVudExpc3RlbmVyKGRlbGV0ZUJ1dHRvbikge1xuICAgICAgICBkZWxldGVCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHRoaXMuX2hhbmRsZURlbGV0ZUV2ZW50KTtcbiAgICB9XG5cbiAgICBfYWRkT3BlblBob3RvRXZlbnRMaXN0ZW5lcihwaG90bykge1xuICAgICAgICBwaG90by5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgICAgIHRoaXMuX2hhbmRsZUNhcmRDbGljayh0aGlzKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG59XG5cbmV4cG9ydCB7Q2FyZH1cbiIsImNsYXNzIFBvcHVwIHtcbiAgICBjb25zdHJ1Y3Rvcihwb3B1cFNlbGVjdG9yKSB7XG4gICAgICAgIHRoaXMuX3BvcHVwID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihwb3B1cFNlbGVjdG9yKTtcbiAgICB9XG5cbiAgICBvcGVuKCkge1xuICAgICAgICB0aGlzLl9wb3B1cC5jbGFzc0xpc3QuYWRkKFwicG9wdXBfb3BlbmVkXCIpO1xuICAgICAgICB0aGlzLnNldEV2ZW50TGlzdGVuZXJzKCk7XG4gICAgfVxuXG4gICAgY2xvc2UgPSAoKSA9PiB7XG4gICAgICAgIHRoaXMuX3BvcHVwLmNsYXNzTGlzdC5yZW1vdmUoXCJwb3B1cF9vcGVuZWRcIik7XG4gICAgICAgIHRoaXMucmVtb3ZlRXZlbnRMaXN0ZW5lcnMoKTtcbiAgICB9XG5cbiAgICBzZXRFdmVudExpc3RlbmVycygpIHtcbiAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCB0aGlzLl9oYW5kbGVDbGlja09uT3ZlcmxheUNsb3NlKTtcbiAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIHRoaXMuX2hhbmRsZUVzY0Nsb3NlKTtcbiAgICAgIHRoaXMuX3BvcHVwLnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cF9fY2xvc2UtYnV0dG9uJykuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHRoaXMuY2xvc2UpO1xuICAgIH1cblxuICAgIHJlbW92ZUV2ZW50TGlzdGVuZXJzKCkge1xuICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHRoaXMuX2hhbmRsZUNsaWNrT25PdmVybGF5Q2xvc2UpO1xuICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgdGhpcy5faGFuZGxlRXNjQ2xvc2UpO1xuICAgICAgdGhpcy5fcG9wdXAucXVlcnlTZWxlY3RvcignLnBvcHVwX19jbG9zZS1idXR0b24nKS5yZW1vdmVFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgY2xvc2UpO1xuICAgIH1cblxuICAgIF9oYW5kbGVFc2NDbG9zZSA9IChldnQpID0+IHtcbiAgICAgICAgaWYoZXZ0LmtleSA9PSBcIkVzY2FwZVwiICYmIHRoaXMuX3BvcHVwLmNsYXNzTGlzdC5jb250YWlucygncG9wdXBfb3BlbmVkJykpe1xuICAgICAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgX2hhbmRsZUNsaWNrT25PdmVybGF5Q2xvc2UgPSAoZXZ0KSA9PiB7XG4gICAgICAgIGlmKGV2dC50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKFwicG9wdXBcIikpe1xuICAgICAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgICB9XG4gIH1cblxufVxuXG5leHBvcnQge1BvcHVwfTtcbiIsImltcG9ydCB7IFBvcHVwIH0gZnJvbSBcIi4vUG9wdXAuanNcIjtcblxuY2xhc3MgUG9wdXBXaXRoRm9ybSBleHRlbmRzIFBvcHVwIHtcbiAgICBjb25zdHJ1Y3Rvcihwb3B1cFNlbGVjdG9yLCBoYW5kbGVTdWJtaXQpIHtcbiAgICAgIHN1cGVyKHBvcHVwU2VsZWN0b3IpO1xuICAgICAgdGhpcy5faGFuZGxlU3VibWl0ID0gaGFuZGxlU3VibWl0O1xuICAgICAgdGhpcy5fZm9ybSA9IHRoaXMuX3BvcHVwLnF1ZXJ5U2VsZWN0b3IoJy5mb3JtJyk7XG4gICAgICB0aGlzLl9zdWJtaXRCdXR0b24gPSB0aGlzLl9wb3B1cC5xdWVyeVNlbGVjdG9yKCcuZm9ybV9fc3VibWl0LWJ1dHRvbicpO1xuICAgIH1cblxuICAgIF9nZXRJbnB1dFZhbHVlcygpIHtcbiAgICAgICAgY29uc3QgaW5wdXRWYWx1ZXMgPSB7fTtcbiAgICAgICAgY29uc3QgaW5wdXRzID0gQXJyYXkuZnJvbSh0aGlzLl9wb3B1cC5xdWVyeVNlbGVjdG9yQWxsKFwiLmZvcm1fX3RleHQtaW5wdXRcIikpO1xuXG4gICAgICAgIGlucHV0cy5mb3JFYWNoKChpbnB1dCkgPT4ge1xuICAgICAgICAgICAgaW5wdXRWYWx1ZXNbaW5wdXQuZ2V0QXR0cmlidXRlKCduYW1lJyldID0gaW5wdXQudmFsdWU7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiBpbnB1dFZhbHVlcztcbiAgICB9XG5cbiAgICBzZXRCdXR0b25UZXh0KHRleHQpIHtcbiAgICAgIHRoaXMuX3N1Ym1pdEJ1dHRvbi50ZXh0Q29udGVudCA9IHRleHQ7XG4gICAgfVxuXG4gICAgc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XG4gICAgICB0aGlzLl9mb3JtLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgdGhpcy5faGFuZGxlUHJvZmlsZUZvcm1TdWJtaXQpO1xuICAgICAgc3VwZXIuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcbiAgICB9XG5cbiAgICByZW1vdmVFdmVudExpc3RlbmVycygpIHtcbiAgICAgIHRoaXMuX2Zvcm0ucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCB0aGlzLl9oYW5kbGVQcm9maWxlRm9ybVN1Ym1pdCk7XG4gICAgICBzdXBlci5yZW1vdmVFdmVudExpc3RlbmVycygpO1xuICAgIH1cblxuICAgIGNsb3NlKCkge1xuICAgICAgICB0aGlzLl9mb3JtLnJlc2V0KCk7XG4gICAgICAgIHN1cGVyLmNsb3NlKCk7XG4gICAgfVxuXG4gICAgX2hhbmRsZVByb2ZpbGVGb3JtU3VibWl0ID0gKGV2dCkgPT4ge1xuICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICB0aGlzLl9oYW5kbGVTdWJtaXQodGhpcywgdGhpcy5fZ2V0SW5wdXRWYWx1ZXMoKSk7XG4gICAgfVxufVxuXG5leHBvcnQgeyBQb3B1cFdpdGhGb3JtIH1cbiIsImNsYXNzIFNlY3Rpb24ge1xuICAgIGNvbnN0cnVjdG9yKCB7IGl0ZW1zLCByZW5kZXJlciB9LCBjb250YWluZXJTZWxlY3Rvcikge1xuICAgICAgICB0aGlzLl9pdGVtcyA9IGl0ZW1zO1xuICAgICAgICB0aGlzLl9yZW5kZXJlciA9IHJlbmRlcmVyO1xuICAgICAgICB0aGlzLl9jb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGNvbnRhaW5lclNlbGVjdG9yKTtcbiAgICB9XG5cbiAgICBjbGVhcigpIHtcbiAgICAgICAgdGhpcy5fY29udGFpbmVyLmlubmVySFRNTCA9IFwiXCI7XG4gICAgfVxuXG4gICAgcmVuZGVyZXIoKSB7XG4gICAgICAgIHRoaXMuY2xlYXIoKTtcblxuICAgICAgICB0aGlzLl9pdGVtcy5mb3JFYWNoKGl0ZW0gPT4ge1xuICAgICAgICAgIHRoaXMuYWRkSXRlbSh0aGlzLl9yZW5kZXJlcihpdGVtKSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGFkZEl0ZW0oaXRlbSkge1xuICAgICAgICB0aGlzLl9jb250YWluZXIucHJlcGVuZChpdGVtKTtcbiAgICB9XG59XG5cbmV4cG9ydCB7U2VjdGlvbn1cbiIsImV4cG9ydCBjb25zdCB1c2VyU2VsZWN0b3JzID0ge1xuICBuYW1lU2VsZWN0b3I6IFwiLnByb2ZpbGVfX25hbWVcIixcbiAgam9iU2VsZWN0b3I6IFwiLnByb2ZpbGVfX2Rlc2NyaXB0aW9uXCIsXG4gIGF2YXRhclNlbGVjdG9yOiBcIi5wcm9maWxlX19waG90b1wiXG59O1xuXG5leHBvcnQgY29uc3QgaW5pdGlhbFVzZXJJbmZvID0ge1xuICBuZXdOYW1lOiBcIkphY3F1ZXMgQ291c3RlYXVcIixcbiAgbmV3Sm9iOiBcIkV4cGxvcmVyXCJcbn07XG5cbi8qKiBEZWNsYXJhdGlvbiBvZiB0aGUgUG9wdXBzICovXG5leHBvcnQgY29uc3QgcG9wdXBFZGl0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBvcHVwLWVkaXQnKTtcbmV4cG9ydCBjb25zdCBwb3B1cEFkZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cC1hZGQnKTtcbmV4cG9ydCBjb25zdCBwb3B1cFBob3RvID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBvcHVwLXBob3RvJyk7XG5leHBvcnQgY29uc3QgcG9wdXBEZWxldGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucG9wdXAtZGVsZXRlJylcbmV4cG9ydCBjb25zdCBwb3B1cEVkaXRBdmF0YXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucG9wdXAtZWRpdC1hdmF0YXInKTtcblxuLyoqIERlY2xhcmF0aW9uIG9mIHRoZSBDbG9zZSBCdXR0b25zICovXG5leHBvcnQgY29uc3QgY2xvc2VCdXR0b25FZGl0ID0gcG9wdXBFZGl0LnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cF9fY2xvc2UtYnV0dG9uJyk7XG5leHBvcnQgY29uc3QgY2xvc2VCdXR0b25BZGQgPSBwb3B1cEFkZC5xdWVyeVNlbGVjdG9yKCcucG9wdXBfX2Nsb3NlLWJ1dHRvbicpO1xuZXhwb3J0IGNvbnN0IGNsb3NlQnV0dG9uUGhvdG8gPSBwb3B1cFBob3RvLnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cF9fY2xvc2UtYnV0dG9uJyk7XG5leHBvcnQgY29uc3QgY2xvc2VCdXR0b25EZWxldGUgPSBwb3B1cERlbGV0ZS5xdWVyeVNlbGVjdG9yKCcucG9wdXBfX2Nsb3NlLWJ1dHRvbicpO1xuZXhwb3J0IGNvbnN0IGNsb3NlQnV0dG9uRWRpdEF2YXRhciA9IHBvcHVwRWRpdEF2YXRhci5xdWVyeVNlbGVjdG9yKCcucG9wdXBfX2Nsb3NlLWJ1dHRvbicpO1xuXG4vKiogRGVjbGFyYXRpb24gb2YgdGhlIEZvcm1zICovXG5cbmV4cG9ydCBjb25zdCBmb3JtRWRpdE5hbWUgPSAnZWRpdC1mb3JtJztcbmV4cG9ydCBjb25zdCBmb3JtQWRkTmFtZSA9ICdhZGQtZm9ybSc7XG5leHBvcnQgY29uc3QgZm9ybURlbGV0ZU5hbWUgPSAnZGVsZXRlLWZvcm0nO1xuZXhwb3J0IGNvbnN0IGZvcm1FZGl0QXZhdGFyTmFtZSA9ICdlZGl0LWF2YXRhci1mb3JtJztcblxuZXhwb3J0IGNvbnN0IGZvcm1FZGl0ID0gcG9wdXBFZGl0LnF1ZXJ5U2VsZWN0b3IoJy5mb3JtJyk7XG5leHBvcnQgY29uc3QgbmFtZUlucHV0ID0gZm9ybUVkaXQucXVlcnlTZWxlY3RvcignLmZvcm1fX3RleHQtaW5wdXRbbmFtZT1cIm5hbWVcIl0nKTtcbmV4cG9ydCBjb25zdCBkZXNjcmlwdGlvbklucHV0ID0gZm9ybUVkaXQucXVlcnlTZWxlY3RvcignLmZvcm1fX3RleHQtaW5wdXRbbmFtZT1cImFib3V0LW1lXCJdJyk7XG5cbmV4cG9ydCBjb25zdCBmb3JtQWRkID0gcG9wdXBBZGQucXVlcnlTZWxlY3RvcignLmZvcm0nKTtcbmV4cG9ydCBjb25zdCB0aXRsZUlucHV0ID0gZm9ybUFkZC5xdWVyeVNlbGVjdG9yKCcuZm9ybV9fdGV4dC1pbnB1dFtuYW1lPVwidGl0bGVcIl0nKTtcbmV4cG9ydCBjb25zdCBsaW5rSW5wdXQgPSBmb3JtQWRkLnF1ZXJ5U2VsZWN0b3IoJy5mb3JtX190ZXh0LWlucHV0W25hbWU9XCJpbWFnZS1saW5rXCJdJyk7XG5cbmV4cG9ydCBjb25zdCBmb3JtRWRpdEF2YXRhciA9IHBvcHVwRWRpdEF2YXRhci5xdWVyeVNlbGVjdG9yKCcuZm9ybScpO1xuZXhwb3J0IGNvbnN0IGF2YXRhckxpbmtJbnB1dCA9IGZvcm1FZGl0QXZhdGFyLnF1ZXJ5U2VsZWN0b3IoJy5mb3JtX190ZXh0LWlucHV0W25hbWU9XCJhdmF0YXItbGlua1wiXScpO1xuXG5leHBvcnQgY29uc3QgcHJvZmlsZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wcm9maWxlJyk7XG5leHBvcnQgY29uc3QgZWRpdEJ1dHRvbiA9IHByb2ZpbGUucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19lZGl0LWJ1dHRvblwiKTtcbmV4cG9ydCBjb25zdCBhZGRCdXR0b24gPSBwcm9maWxlLnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fYWRkLWJ1dHRvblwiKTtcbmV4cG9ydCBjb25zdCBlZGl0QXZhdGFyQnV0dG9uID0gcHJvZmlsZS5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX3Bob3RvLWVkaXQtYnV0dG9uXCIpO1xuXG4vKiogRGVjbGFyYXRpb24gb2YgdGhlIFBob3RvcyAqL1xuZXhwb3J0IGNvbnN0IHBob3RvR3JpZFNlbGVjdG9yID0gXCIucGhvdG9zX19ncmlkXCI7XG5leHBvcnQgY29uc3QgcGhvdG9DYXJkVGVtcGxhdGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3Bob3RvLWNhcmRfX3RlbXBsYXRlXCIpLmNvbnRlbnQ7XG5cbmV4cG9ydCBjb25zdCBmb3JtcyA9IG5ldyBNYXAoKTtcblxuLyoqIERlY2xhcmF0aW9uIG9mIHRoZSBTZXR0aW5nIG9iamVjdCBmb3IgY2FyZCB2YWxpZGF0aW9uICovXG5leHBvcnQgY29uc3QgdmFsaWRhdGlvbkNvbmZpZyA9IHtcbiAgZm9ybVNlbGVjdG9yOiBcIi5mb3JtXCIsXG4gIGlucHV0U2VsZWN0b3I6IFwiLmZvcm1fX3RleHQtaW5wdXRcIixcbiAgc3VibWl0QnV0dG9uU2VsZWN0b3I6IFwiLmZvcm1fX3N1Ym1pdC1idXR0b25cIixcbiAgaW5hY3RpdmVCdXR0b25DbGFzczogXCJmb3JtX19zdWJtaXQtYnV0dG9uX2Rpc2FibGVkXCIsXG4gIGlucHV0RXJyb3JDbGFzczogXCJmb3JtX190ZXh0LWlucHV0LWVycm9yX2FjdGl2ZVwiLFxuICBlcnJvckNsYXNzOiBcImZvcm1fX2lucHV0LWVycm9yX3Zpc2libGVcIlxufTtcblxuXG4iLCJpbXBvcnQgXCIuL2luZGV4LmNzc1wiO1xuXG5pbXBvcnQgeyBGb3JtVmFsaWRhdG9yIH0gZnJvbSBcIi4uL2NvbXBvbmVudHMvRm9ybVZhbGlkYXRvci5qc1wiO1xuaW1wb3J0IHsgQ2FyZCB9IGZyb20gXCIuLi9jb21wb25lbnRzL0NhcmQuanNcIjtcbmltcG9ydCB7IFBvcHVwV2l0aEZvcm0gfSBmcm9tIFwiLi4vY29tcG9uZW50cy9Qb3B1cFdpdGhGb3JtLmpzXCI7XG5pbXBvcnQgeyBQb3B1cFdpdGhJbWFnZSB9IGZyb20gXCIuLi9jb21wb25lbnRzL1BvcHVwV2l0aEltYWdlLmpzXCI7XG5pbXBvcnQgeyBVc2VySW5mbyB9IGZyb20gXCIuLi9jb21wb25lbnRzL1VzZXJJbmZvLmpzXCJcbmltcG9ydCB7IFNlY3Rpb24gfSBmcm9tIFwiLi4vY29tcG9uZW50cy9TZWN0aW9uLmpzXCI7XG5pbXBvcnQgeyBBcGkgfSBmcm9tIFwiLi4vY29tcG9uZW50cy9BcGkuanNcIlxuaW1wb3J0ICogYXMgY29uc3RhbnRzIGZyb20gXCIuLi91dGlscy9jb25zdGFudHNcIjtcblxubGV0IGNhcmRUb0RlbGV0ZTtcblxuLyoqXG4gKiBIYW5kbGVzIGNhcmQgY3JlYXRpb24gb24gU2VjdGlvblxuICogQHBhcmFtIHtzdHJpbmd9IG5hbWUgLSBUaGUgdGl0bGUgb2YgdGhlIGNhcmRcbiAqIEBwYXJhbSB7c3RyaW5nfSBsaW5rIC0gVGhlIGxpbmsgb2YgdGhlIHBob3RvXG4gKi9cbmZ1bmN0aW9uIHJlbmRlckNhcmQoY2FyZCkge1xuICBjb25zdCBuZXdDYXJkID0gbmV3IENhcmQoY2FyZCwgY29uc3RhbnRzLnBob3RvQ2FyZFRlbXBsYXRlLCBoYW5kbGVDYXJkQ2xpY2ssICBoYW5kbGVDYXJkRGVsZXRlQ2xpY2ssIGhhbmRsZUxpa2VDbGljayk7XG4gIGNvbnN0IHBob3RvQ2FyZCA9IG5ld0NhcmQuY3JlYXRlQ2FyZCgpO1xuICBuZXdDYXJkLnVwZGF0ZUxpa2VzKG5ld0NhcmQuX2xpa2VzLCB1c2VySW5mby5faWQpO1xuICByZXR1cm4gcGhvdG9DYXJkO1xufVxuXG4vKipcbiAqIEhhbmRsZXMgbmV3IHBsYWNlIGZvcm0gc3VibWl0IChTZW50IHRvIHBvcHVwV2l0aEZvcm0pXG4gKi9cbmZ1bmN0aW9uIGhhbmRsZU5ld1BsYWNlRm9ybVN1Ym1pdChwb3B1cCwgaW5wdXREYXRhKSB7XG4gIGNvbnN0IGNhcmREYXRhID0ge1xuICAgIGNhcmROYW1lOiBpbnB1dERhdGFbXCJ0aXRsZVwiXSxcbiAgICBjYXJkTGluazogaW5wdXREYXRhW1wiaW1hZ2UtbGlua1wiXVxuICB9O1xuICBwb3B1cC5zZXRCdXR0b25UZXh0KFwiU2F2aW5nLi4uXCIpO1xuICBhcGkuc2V0TmV3Q2FyZChjYXJkRGF0YSlcbiAgICAudGhlbihyZXMgPT4ge1xuICAgICAgc2VjdGlvbi5hZGRJdGVtKHJlbmRlckNhcmQocmVzKSk7XG4gICAgICBwb3B1cC5jbG9zZSgpO1xuICAgICAgfSlcbiAgICAuY2F0Y2goIGVyciA9PiB7XG4gICAgICBjb25zb2xlLmxvZyhlcnIpO1xuICAgIH0pXG4gICAgLmZpbmFsbHkoKCkgPT4ge1xuICAgICAgcG9wdXAuc2V0QnV0dG9uVGV4dChcIkNyZWF0ZVwiKTtcbiAgICB9KVxufVxuXG4vKipcbiAqIEhhbmRsZXMgbmV3IHByb2ZpbGUgZm9ybSBzdWJtaXQgKFNlbnQgdG8gcG9wdXBXaXRoRm9ybSlcbiAqL1xuZnVuY3Rpb24gaGFuZGxlUHJvZmlsZUZvcm1TdWJtaXQocG9wdXAsIGlucHV0RGF0YSkge1xuICBwb3B1cC5zZXRCdXR0b25UZXh0KFwiU2F2aW5nLi4uXCIpO1xuICBhcGkuc2V0VXNlckluZm8oeyBuZXdOYW1lOiBpbnB1dERhdGFbXCJuYW1lXCJdLCBuZXdBYm91dDogaW5wdXREYXRhW1wiYWJvdXQtbWVcIl0gfSlcbiAgLnRoZW4oIHJlcyA9PiB7XG4gICAgdXNlckluZm8uc2V0VXNlckluZm8ocmVzKTtcbiAgICBwb3B1cC5jbG9zZSgpO1xuICB9KVxuICAuY2F0Y2goIGVyciA9PiB7XG4gICAgY29uc29sZS5sb2coZXJyKTtcbiAgfSlcbiAgLmZpbmFsbHkoKCkgPT4ge1xuICAgIHBvcHVwLnNldEJ1dHRvblRleHQoXCJTYXZlXCIpO1xuICB9KVxufVxuXG4vKipcbiAqIERlbGV0ZXMgdGhlIHNlbGVjdGVkIENhcmRcbiAqL1xuZnVuY3Rpb24gaGFuZGxlRGVsZXRlRm9ybVN1Ym1pdChwb3B1cCkge1xuICBwb3B1cC5zZXRCdXR0b25UZXh0KFwiRGVsZXRpbmcuLi5cIik7XG4gIGFwaS5kZWxldGVDYXJkKGNhcmRUb0RlbGV0ZS5nZXRJZCgpKVxuICAgIC50aGVuKCgpID0+IHtcbiAgICAgIGNhcmRUb0RlbGV0ZS5kZWxldGVDYXJkKCk7XG4gICAgICBjYXJkVG9EZWxldGU9bnVsbDtcbiAgICAgIHBvcHVwLmNsb3NlKCk7XG4gICAgfSlcbiAgICAuY2F0Y2goIGVyciA9PiB7XG4gICAgICBjb25zb2xlLmxvZyhlcnIpO1xuICAgIH0pXG4gICAgLmZpbmFsbHkoKCkgPT4ge1xuICAgICAgcG9wdXAuc2V0QnV0dG9uVGV4dChcIlllc1wiKTtcbiAgICB9KVxufVxuXG4vKipcbiAqIFVwZGF0ZXMgdGhlIGF2YXRhciBwaG90b1xuICovXG5mdW5jdGlvbiBoYW5kbGVFZGl0QXZhdGFyRm9ybVN1Ym1pdChwb3B1cCwgaW5wdXREYXRhKSB7XG4gIHBvcHVwLnNldEJ1dHRvblRleHQoXCJTYXZpbmcuLi5cIik7XG4gIGFwaS51cGRhdGVBdmF0YXIoaW5wdXREYXRhW1wiYXZhdGFyLWxpbmtcIl0pXG4gICAgLnRoZW4oKHJlcykgPT4ge1xuICAgICAgY29uc29sZS5sb2coXCJBdmF0YXIgdXBkYXRlZCBcIixyZXMpO1xuICAgICAgdXNlckluZm8uc2V0VXNlckluZm8ocmVzKTtcbiAgICAgIHBvcHVwLmNsb3NlKCk7XG4gICAgfSlcbiAgICAuY2F0Y2goIGVyciA9PiB7XG4gICAgICBjb25zb2xlLmxvZyhlcnIpO1xuICAgIH0pXG4gICAgLmZpbmFsbHkoKCkgPT4ge1xuICAgICAgcG9wdXAuc2V0QnV0dG9uVGV4dChcIlNhdmVcIik7XG4gIH0pXG59XG5cbi8qKlxuICogSGFuZGxlcyBvcGVuIHBob3RvIG9uIGNhcmQgY2xpY2sgKHNlbnQgdG8gcG9wdXBXaXRoQ2FyZClcbiAqL1xuZnVuY3Rpb24gaGFuZGxlQ2FyZENsaWNrKGNhcmQpIHtcbiAgcGhvdG9Qb3B1cC5vcGVuKGNhcmQuZ2V0SW1hZ2VMaW5rKCksIGNhcmQuZ2V0TmFtZSgpKTtcbn1cblxuZnVuY3Rpb24gaGFuZGxlQ2FyZERlbGV0ZUNsaWNrKGNhcmQpIHtcbiAgZGVsZXRlUG9wdXAub3BlbigpO1xuICBjYXJkVG9EZWxldGUgPSBjYXJkO1xufVxuXG4vKipcbiAqIENhbGxzIHRoZSBBUEkgdG8gYWRkL3JlbW92ZSBhIGxpa2UgdG8gdGhlIGxpc3QgZGVwZW5kaW5nIG9uIHRoZSBpc0xpa2VkIHBhcmFtLlxuICogQHBhcmFtIHtib29sZWFufSBpc0xpa2VkXG4gKi9cbmZ1bmN0aW9uIGhhbmRsZUxpa2VDbGljayhjYXJkLCBpc0xpa2VkKSB7XG4gIGlmKGlzTGlrZWQpIHtcbiAgICBhcGkuYWRkTGlrZShjYXJkLmdldElkKCkpXG4gICAgICAudGhlbigocmVzKSA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiTGlrZSBhZGRlZCBzdWNjZXNmdWxseVwiLCByZXMubGlrZXMpO1xuICAgICAgICBjYXJkLnVwZGF0ZUxpa2VzKHJlcy5saWtlcywgdXNlckluZm8uZ2V0SWQoKSk7XG4gICAgICB9KVxuICAgICAgLmNhdGNoKCBlcnIgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZyhlcnIpO1xuICAgICAgfSlcbiAgfSBlbHNlIHtcbiAgICBhcGkucmVtb3ZlTGlrZShjYXJkLmdldElkKCkpXG4gICAgICAudGhlbigocmVzKSA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiTGlrZSByZW1vdmVkIHN1Y2Nlc2Z1bGx5XCIsIHJlcy5saWtlcyk7XG4gICAgICAgIGNhcmQudXBkYXRlTGlrZXMocmVzLmxpa2VzLCB1c2VySW5mby5nZXRJZCgpKTtcbiAgICAgIH0pXG4gICAgICAuY2F0Y2goIGVyciA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKGVycik7XG4gICAgICB9KVxuICB9XG59XG5cbi8qKlxuICogRW5hYmxlcyB2YWxpZGF0aW9uIG9uIGFsbCBmb3Jtcy5cbiAqIFNhdmVzIHRoZSBmb3JtVmFsaWRhdG9ycyBvbiBhIE1hcCBmb3IgZnV0dXJlIGFjY2Vzc1xuICovXG5mdW5jdGlvbiBlbmFibGVGb3JtVmFsaWRhdGlvbk9uQWxsRm9ybXMoKSB7XG4gIGNvbnN0IGZvcm1MaXN0ID0gQXJyYXkuZnJvbShkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKGNvbnN0YW50cy52YWxpZGF0aW9uQ29uZmlnLmZvcm1TZWxlY3RvcikpO1xuICBmb3JtTGlzdC5mb3JFYWNoKChmb3JtRWxlbWVudCkgPT4ge1xuICAgIGNvbnN0IGZvcm1OYW1lID0gZm9ybUVsZW1lbnQuZ2V0QXR0cmlidXRlKFwibmFtZVwiKTtcbiAgICBjb25zdCBmb3JtVmFsaWRhdG9yID0gbmV3IEZvcm1WYWxpZGF0b3IoY29uc3RhbnRzLnZhbGlkYXRpb25Db25maWcsIGZvcm1FbGVtZW50KTtcbiAgICBmb3JtVmFsaWRhdG9yLmVuYWJsZVZhbGlkYXRpb24oKTtcbiAgICBjb25zdGFudHMuZm9ybXMuc2V0KGZvcm1OYW1lLCBmb3JtVmFsaWRhdG9yKTtcbiAgfSk7XG59XG5cbi8qKlxuICogU2V0dGluZyB1cCB0aGUgQXBpIGNsYXNzXG4gKi9cbmNvbnN0IGFwaSA9IG5ldyBBcGkoe1xuICBiYXNlVXJsOiBcImh0dHBzOi8vYXJvdW5kLm5vbW9yZXBhcnRpZXMuY28vdjEvZ3JvdXAtMTJcIixcbiAgaGVhZGVyczoge1xuICAgIGF1dGhvcml6YXRpb246IFwiYjlkMWMzYjYtYzBmNC00MjI0LWFkOGYtNGM4MWVmYTNmODlkXCIsXG4gICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCJcbiAgfVxufSk7XG5cbmNvbnN0IHVzZXJJbmZvID0gbmV3IFVzZXJJbmZvKGNvbnN0YW50cy51c2VyU2VsZWN0b3JzKTtcbmxldCBzZWN0aW9uO1xuXG4vKiogVXNlciBhbmQgY2FyZCBpbmZvcm1hdGlvbiBsb2FkaW5nICovXG5Qcm9taXNlLmFsbChbYXBpLmdldFVzZXJJbmZvKCksIGFwaS5nZXRJbml0aWFsQ2FyZHMoKV0pXG4gIC50aGVuKChbdXNlckRhdGEsIGNhcmRzXSkgPT4ge1xuICAgIHVzZXJJbmZvLnNldFVzZXJJbmZvKHVzZXJEYXRhKTtcblxuICAgIHNlY3Rpb24gPSBuZXcgU2VjdGlvbigge1xuICAgICAgaXRlbXM6IGNhcmRzLFxuICAgICAgcmVuZGVyZXI6IHJlbmRlckNhcmRcbiAgICB9LFxuICAgIGNvbnN0YW50cy5waG90b0dyaWRTZWxlY3Rvcik7XG4gICAgc2VjdGlvbi5yZW5kZXJlcigpO1xuICB9KVxuICAuY2F0Y2goIGVyciA9PiB7XG4gICAgY29uc29sZS5sb2coZXJyKTtcbiAgfSk7XG5cblxuLyoqIFBvcHVwIGxvYWRpbmcgYW5kIGV2ZW50IGxpc3RlbmVyIHNldHVwICovXG5jb25zdCBhZGRQb3B1cCA9IG5ldyBQb3B1cFdpdGhGb3JtKCcucG9wdXAtYWRkJywgaGFuZGxlTmV3UGxhY2VGb3JtU3VibWl0KTtcbmNvbnN0IGVkaXRQb3B1cCA9IG5ldyBQb3B1cFdpdGhGb3JtKCcucG9wdXAtZWRpdCcsIGhhbmRsZVByb2ZpbGVGb3JtU3VibWl0KTtcbmNvbnN0IGRlbGV0ZVBvcHVwID0gbmV3IFBvcHVwV2l0aEZvcm0oJy5wb3B1cC1kZWxldGUnLCBoYW5kbGVEZWxldGVGb3JtU3VibWl0KTtcbmNvbnN0IHBob3RvUG9wdXAgPSBuZXcgUG9wdXBXaXRoSW1hZ2UoJy5wb3B1cC1waG90bycpO1xuY29uc3QgZWRpdEF2YXRhclBvcHVwID0gbmV3IFBvcHVwV2l0aEZvcm0oJy5wb3B1cC1lZGl0LWF2YXRhcicsIGhhbmRsZUVkaXRBdmF0YXJGb3JtU3VibWl0KTtcblxuLyoqIEVuYWJsZSBWYWxpZGF0aW9uICovXG5lbmFibGVGb3JtVmFsaWRhdGlvbk9uQWxsRm9ybXMoKTtcblxuXG4vKiogRGVjbGFyYXRpb24gb2YgdGhlIGV2ZW50IGxpc3RlbmVycyAqL1xuXG4vKiogQWRkIFBvcHVwIGFuZCBGb3JtICovXG5jb25zdGFudHMuYWRkQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gIGFkZFBvcHVwLm9wZW4oKTtcbiAgY29uc3RhbnRzLmZvcm1zLmdldChjb25zdGFudHMuZm9ybUFkZE5hbWUpLnJlc2V0VmFsaWRhdGlvbigpO1xufSk7XG5cblxuLyoqIEVkaXQgUG9wdXAgYW5kIEZvcm0gKi9cbmNvbnN0YW50cy5lZGl0QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gIGNvbnN0IGN1cnJlbnRVc2VySW5mbyA9IHVzZXJJbmZvLmdldFVzZXJJbmZvKCk7XG4gIGNvbnN0YW50cy5uYW1lSW5wdXQudmFsdWUgPSBjdXJyZW50VXNlckluZm8ubmFtZTtcbiAgY29uc3RhbnRzLmRlc2NyaXB0aW9uSW5wdXQudmFsdWUgPSBjdXJyZW50VXNlckluZm8uam9iO1xuICBlZGl0UG9wdXAub3BlbigpO1xuICBjb25zdGFudHMuZm9ybXMuZ2V0KGNvbnN0YW50cy5mb3JtRWRpdE5hbWUpLnJlc2V0VmFsaWRhdGlvbigpO1xufSk7XG5cblxuLyoqIEVkaXQgYXZhdGFyIHBvcHVwICovXG5jb25zdGFudHMuZWRpdEF2YXRhckJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICBlZGl0QXZhdGFyUG9wdXAub3BlbigpO1xuICBjb25zdGFudHMuZm9ybXMuZ2V0KGNvbnN0YW50cy5mb3JtRWRpdEF2YXRhck5hbWUpLnJlc2V0VmFsaWRhdGlvbigpO1xufSk7XG5cblxuXG5cbiIsImNsYXNzIEFwaSB7XG4gICAgY29uc3RydWN0b3Iob3B0aW9ucykge1xuICAgICAgICB0aGlzLl9vcHRpb25zID0gb3B0aW9ucztcbiAgICB9XG5cbiAgICBnZXRJbml0aWFsQ2FyZHMoKSB7XG4gICAgICAgIHJldHVybiBmZXRjaCh0aGlzLl9vcHRpb25zLmJhc2VVcmwrXCIvY2FyZHMvXCIsIHtcbiAgICAgICAgICAgIGhlYWRlcnM6IHRoaXMuX29wdGlvbnMuaGVhZGVyc1xuICAgICAgICAgIH0pXG4gICAgICAgICAgLnRoZW4ocmVzID0+IHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9jaGVja1Jlc3BvbnNlKHJlcyk7XG4gICAgICAgICAgfSlcbiAgICAgICAgICAudGhlbiggcmVzID0+IHtcbiAgICAgICAgICAgIHJldHVybiByZXM7XG4gICAgICAgICAgfSlcbiAgICB9XG5cbiAgICBzZXROZXdDYXJkKCB7IGNhcmROYW1lLCBjYXJkTGluayB9KSB7XG4gICAgICByZXR1cm4gZmV0Y2godGhpcy5fb3B0aW9ucy5iYXNlVXJsK1wiL2NhcmRzL1wiLCB7XG4gICAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICAgIGhlYWRlcnM6IHRoaXMuX29wdGlvbnMuaGVhZGVycyxcbiAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgIG5hbWU6IGNhcmROYW1lLFxuICAgICAgICAgIGxpbms6IGNhcmRMaW5rXG4gICAgICAgIH0pXG4gICAgICB9KVxuICAgICAgLnRoZW4ocmVzID0+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2NoZWNrUmVzcG9uc2UocmVzKTtcbiAgICAgIH0pXG4gICAgICAudGhlbiggcmVzID0+IHtcbiAgICAgICAgcmV0dXJuIHJlcztcbiAgICAgIH0pXG4gICAgfVxuXG4gICAgYWRkTGlrZShpZCkge1xuICAgICAgcmV0dXJuIGZldGNoKHRoaXMuX29wdGlvbnMuYmFzZVVybCtcIi9jYXJkcy9saWtlcy9cIitpZCwge1xuICAgICAgICBtZXRob2Q6IFwiUFVUXCIsXG4gICAgICAgIGhlYWRlcnM6IHRoaXMuX29wdGlvbnMuaGVhZGVyc1xuICAgICAgfSlcbiAgICAgIC50aGVuKHJlcyA9PiB7XG4gICAgICAgIHJldHVybiB0aGlzLl9jaGVja1Jlc3BvbnNlKHJlcyk7XG4gICAgICB9KVxuICAgICAgLnRoZW4oIHJlcyA9PiB7XG4gICAgICAgIHJldHVybiByZXM7XG4gICAgICB9KVxuICAgIH1cblxuICAgIHJlbW92ZUxpa2UoaWQpIHtcbiAgICAgIHJldHVybiBmZXRjaCh0aGlzLl9vcHRpb25zLmJhc2VVcmwrXCIvY2FyZHMvbGlrZXMvXCIraWQsIHtcbiAgICAgICAgbWV0aG9kOiBcIkRFTEVURVwiLFxuICAgICAgICBoZWFkZXJzOiB0aGlzLl9vcHRpb25zLmhlYWRlcnNcbiAgICAgIH0pXG4gICAgICAudGhlbihyZXMgPT4ge1xuICAgICAgICByZXR1cm4gdGhpcy5fY2hlY2tSZXNwb25zZShyZXMpO1xuICAgICAgfSlcbiAgICAgIC50aGVuKCByZXMgPT4ge1xuICAgICAgICByZXR1cm4gcmVzO1xuICAgICAgfSlcbiAgICB9XG5cbiAgICBkZWxldGVDYXJkKGlkKSB7XG4gICAgICByZXR1cm4gZmV0Y2godGhpcy5fb3B0aW9ucy5iYXNlVXJsK1wiL2NhcmRzL1wiK2lkLCB7XG4gICAgICAgIG1ldGhvZDogXCJERUxFVEVcIixcbiAgICAgICAgaGVhZGVyczogdGhpcy5fb3B0aW9ucy5oZWFkZXJzXG4gICAgICB9KVxuICAgICAgLnRoZW4ocmVzID0+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2NoZWNrUmVzcG9uc2UocmVzKTtcbiAgICAgIH0pXG4gICAgICAudGhlbiggcmVzID0+IHtcbiAgICAgICAgcmV0dXJuIHJlcztcbiAgICAgIH0pXG4gICAgfVxuXG4gICAgZ2V0VXNlckluZm8oKSB7XG4gICAgICByZXR1cm4gZmV0Y2godGhpcy5fb3B0aW9ucy5iYXNlVXJsK1wiL3VzZXJzL21lXCIsIHtcbiAgICAgICAgaGVhZGVyczogdGhpcy5fb3B0aW9ucy5oZWFkZXJzXG4gICAgICB9KVxuICAgICAgLnRoZW4ocmVzID0+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2NoZWNrUmVzcG9uc2UocmVzKTtcbiAgICAgIH0pXG4gICAgICAudGhlbiggcmVzID0+IHtcbiAgICAgICAgcmV0dXJuIHJlcztcbiAgICAgIH0pXG4gICAgfVxuXG4gICAgc2V0VXNlckluZm8oIHsgbmV3TmFtZSwgbmV3QWJvdXQgfSkge1xuICAgICAgcmV0dXJuIGZldGNoKHRoaXMuX29wdGlvbnMuYmFzZVVybCtcIi91c2Vycy9tZVwiLCB7XG4gICAgICAgIG1ldGhvZDogXCJQQVRDSFwiLFxuICAgICAgICBoZWFkZXJzOiB0aGlzLl9vcHRpb25zLmhlYWRlcnMsXG4gICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICBuYW1lOiBuZXdOYW1lLFxuICAgICAgICAgIGFib3V0OiBuZXdBYm91dFxuICAgICAgICB9KVxuICAgICAgfSlcbiAgICAgIC50aGVuKHJlcyA9PiB7XG4gICAgICAgIHJldHVybiB0aGlzLl9jaGVja1Jlc3BvbnNlKHJlcyk7XG4gICAgICB9KVxuICAgICAgLnRoZW4oIHJlcyA9PiB7XG4gICAgICAgIHJldHVybiByZXM7XG4gICAgICB9KVxuICAgIH1cblxuICAgIHVwZGF0ZUF2YXRhcihsaW5rKSB7XG4gICAgICByZXR1cm4gZmV0Y2godGhpcy5fb3B0aW9ucy5iYXNlVXJsK1wiL3VzZXJzL21lL2F2YXRhclwiLCB7XG4gICAgICAgIG1ldGhvZDogXCJQQVRDSFwiLFxuICAgICAgICBoZWFkZXJzOiB0aGlzLl9vcHRpb25zLmhlYWRlcnMsXG4gICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICBhdmF0YXI6IGxpbmtcbiAgICAgICAgfSlcbiAgICAgIH0pXG4gICAgICAudGhlbihyZXMgPT4ge1xuICAgICAgICByZXR1cm4gdGhpcy5fY2hlY2tSZXNwb25zZShyZXMpO1xuICAgICAgfSlcbiAgICAgIC50aGVuKCByZXMgPT4ge1xuICAgICAgICByZXR1cm4gcmVzO1xuICAgICAgfSlcbiAgICB9XG5cbiAgICBfY2hlY2tSZXNwb25zZShyZXMpIHtcbiAgICAgIGlmIChyZXMub2spIHtcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XG4gICAgICB9XG4gICAgfVxuXG59XG5cbmV4cG9ydCB7IEFwaSB9O1xuIiwiY2xhc3MgVXNlckluZm8ge1xuICAgIGNvbnN0cnVjdG9yKHsgbmFtZVNlbGVjdG9yLCBqb2JTZWxlY3RvciwgYXZhdGFyU2VsZWN0b3IgfSkge1xuICAgICAgICB0aGlzLl9uYW1lU2VsZWN0b3IgPSBuYW1lU2VsZWN0b3I7XG4gICAgICAgIHRoaXMuX2pvYlNlbGVjdG9yID0gam9iU2VsZWN0b3I7XG4gICAgICAgIHRoaXMuX2F2YXRhclNlbGVjdG9yID0gYXZhdGFyU2VsZWN0b3I7XG4gICAgfVxuXG4gICAgZ2V0SWQoKSB7XG4gICAgICBpZih0aGlzLl9pZCkge1xuICAgICAgICByZXR1cm4gdGhpcy5faWQ7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBnZXRVc2VySW5mbygpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIG5hbWU6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IodGhpcy5fbmFtZVNlbGVjdG9yKS50ZXh0Q29udGVudCxcbiAgICAgICAgICAgIGpvYjogZG9jdW1lbnQucXVlcnlTZWxlY3Rvcih0aGlzLl9qb2JTZWxlY3RvcikudGV4dENvbnRlbnQsXG4gICAgICAgICAgICBhdmF0YXI6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IodGhpcy5fYXZhdGFyU2VsZWN0b3IpLnNyYyxcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICBzZXRVc2VySW5mbyggeyBuYW1lLCBhYm91dCwgX2lkLCBhdmF0YXIgfSApIHtcbiAgICAgICAgY29uc3QgbmFtZUVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHRoaXMuX25hbWVTZWxlY3Rvcik7XG4gICAgICAgIGNvbnN0IGpvYkVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHRoaXMuX2pvYlNlbGVjdG9yKTtcbiAgICAgICAgY29uc3QgYXZhdGFyRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IodGhpcy5fYXZhdGFyU2VsZWN0b3IpO1xuXG4gICAgICAgIG5hbWVFbGVtZW50LnRleHRDb250ZW50ID0gbmFtZTtcbiAgICAgICAgam9iRWxlbWVudC50ZXh0Q29udGVudCA9IGFib3V0O1xuICAgICAgICBhdmF0YXJFbGVtZW50LnNyYyA9IGF2YXRhcjtcbiAgICAgICAgdGhpcy5faWQgPSBfaWQ7XG4gICAgfVxufVxuXG5leHBvcnQgeyBVc2VySW5mbyB9O1xuIiwiaW1wb3J0IHsgUG9wdXAgfSBmcm9tIFwiLi9Qb3B1cC5qc1wiO1xuXG5jbGFzcyBQb3B1cFdpdGhJbWFnZSBleHRlbmRzIFBvcHVwIHtcbiAgICBjb25zdHJ1Y3Rvcihwb3B1cFNlbGVjdG9yKSB7XG4gICAgICAgIHN1cGVyKHBvcHVwU2VsZWN0b3IpO1xuICAgIH1cblxuICAgIG9wZW4ocGhvdG9JbWFnZSwgbmFtZSkge1xuICAgICAgICBjb25zdCBwaG90b0NvbnRhaW5lciA9IHRoaXMuX3BvcHVwLnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cC1waG90b19fY29udGFpbmVyJyk7XG4gICAgICAgIGNvbnN0IHBob3RvID0gcGhvdG9Db250YWluZXIucXVlcnlTZWxlY3RvcignLnBvcHVwLXBob3RvX19waG90bycpO1xuICAgICAgICBjb25zdCB0aXRsZSA9IHBob3RvQ29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cC1waG90b19fdGl0bGUnKTtcblxuICAgICAgICBwaG90by5zcmMgPSBwaG90b0ltYWdlO1xuICAgICAgICB0aXRsZS50ZXh0Q29udGVudCA9IG5hbWU7XG4gICAgICAgIHBob3RvLmFsdCA9IG5hbWU7XG4gICAgICAgIHN1cGVyLm9wZW4oKTtcbiAgICB9XG59XG5cbmV4cG9ydCB7IFBvcHVwV2l0aEltYWdlIH07Il0sIm5hbWVzIjpbIkZvcm1WYWxpZGF0b3IiLCJjb25zdHJ1Y3RvciIsInNldHRpbmdzIiwiZm9ybSIsInRoaXMiLCJfc2V0dGluZ3MiLCJfZm9ybSIsIl9zaG93SW5wdXRFcnJvciIsImlucHV0RWxlbWVudCIsImVycm9yTWVzc2FnZSIsImVycm9yRWxlbWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJpZCIsImNsYXNzTGlzdCIsImFkZCIsImlucHV0RXJyb3JDbGFzcyIsInRleHRDb250ZW50IiwiZXJyb3JDbGFzcyIsIl9oaWRlSW5wdXRFcnJvciIsInJlbW92ZSIsIl9jaGVja0lucHV0VmFsaWRpdHkiLCJ2YWxpZGl0eSIsInZhbGlkIiwidmFsaWRhdGlvbk1lc3NhZ2UiLCJfaGFzSW52YWxpZElucHV0IiwiX2lucHV0TGlzdCIsInNvbWUiLCJfdG9nZ2xlQnV0dG9uU3RhdGUiLCJfYnV0dG9uRWxlbWVudCIsImluYWN0aXZlQnV0dG9uQ2xhc3MiLCJzZXRBdHRyaWJ1dGUiLCJyZW1vdmVBdHRyaWJ1dGUiLCJfc2V0RXZlbnRMaXN0ZW5lcnMiLCJBcnJheSIsImZyb20iLCJxdWVyeVNlbGVjdG9yQWxsIiwiaW5wdXRTZWxlY3RvciIsInN1Ym1pdEJ1dHRvblNlbGVjdG9yIiwiZm9yRWFjaCIsImFkZEV2ZW50TGlzdGVuZXIiLCJyZXNldFZhbGlkYXRpb24iLCJlbmFibGVWYWxpZGF0aW9uIiwiZXZ0IiwicHJldmVudERlZmF1bHQiLCJkb2N1bWVudCIsIkNhcmQiLCJjYXJkU2VsZWN0b3IiLCJoYW5kbGVDYXJkQ2xpY2siLCJoYW5kbGVEZWxldGVDYXJkQ2xpY2siLCJoYW5kbGVMaWtlQ2xpY2siLCJfaWQiLCJuYW1lIiwibGluayIsImxpa2VzIiwiX2VsZW1lbnQiLCJjb250YWlucyIsIl9oYW5kbGVMaWtlQ2xpY2siLCJfaGFuZGxlRGVsZXRlQ2FyZENsaWNrIiwiX25hbWUiLCJfaW1hZ2UiLCJfbGlrZXMiLCJfY2FyZFNlbGVjdG9yIiwiX2hhbmRsZUNhcmRDbGljayIsImdldElkIiwiZ2V0TmFtZSIsImdldEltYWdlTGluayIsImNyZWF0ZUNhcmQiLCJfY3JlYXRlTmV3UGhvdG9DYXJkRWxlbWVudCIsIl9hZGRFdmVudExpc3RlbmVycyIsImRlbGV0ZUNhcmQiLCJ1cGRhdGVMaWtlcyIsInVzZXJJZCIsImxpa2VCdXR0b24iLCJsZW5ndGgiLCJKU09OIiwic3RyaW5naWZ5IiwiaW5jbHVkZXMiLCJfYWRkTGlrZUV2ZW50TGlzdGVuZXIiLCJkZWxldGVCdXR0b24iLCJfYWRkRGVsZXRlRXZlbnRMaXN0ZW5lciIsInBob3RvIiwiX2FkZE9wZW5QaG90b0V2ZW50TGlzdGVuZXIiLCJwaG90b0NhcmQiLCJjbG9uZU5vZGUiLCJwaG90b1RpdGxlIiwicGhvdG9MaWtlcyIsInNyYyIsImFsdCIsIl9oYW5kbGVMaWtlRXZlbnQiLCJfaGFuZGxlRGVsZXRlRXZlbnQiLCJQb3B1cCIsInBvcHVwU2VsZWN0b3IiLCJfcG9wdXAiLCJyZW1vdmVFdmVudExpc3RlbmVycyIsImtleSIsImNsb3NlIiwidGFyZ2V0Iiwib3BlbiIsInNldEV2ZW50TGlzdGVuZXJzIiwiX2hhbmRsZUNsaWNrT25PdmVybGF5Q2xvc2UiLCJfaGFuZGxlRXNjQ2xvc2UiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwiUG9wdXBXaXRoRm9ybSIsImhhbmRsZVN1Ym1pdCIsInN1cGVyIiwiX2hhbmRsZVN1Ym1pdCIsIl9nZXRJbnB1dFZhbHVlcyIsIl9zdWJtaXRCdXR0b24iLCJpbnB1dFZhbHVlcyIsImlucHV0IiwiZ2V0QXR0cmlidXRlIiwidmFsdWUiLCJzZXRCdXR0b25UZXh0IiwidGV4dCIsIl9oYW5kbGVQcm9maWxlRm9ybVN1Ym1pdCIsInJlc2V0IiwiU2VjdGlvbiIsImNvbnRhaW5lclNlbGVjdG9yIiwiaXRlbXMiLCJyZW5kZXJlciIsIl9pdGVtcyIsIl9yZW5kZXJlciIsIl9jb250YWluZXIiLCJjbGVhciIsImlubmVySFRNTCIsIml0ZW0iLCJhZGRJdGVtIiwicHJlcGVuZCIsInBvcHVwRWRpdCIsInBvcHVwQWRkIiwicG9wdXBQaG90byIsInBvcHVwRGVsZXRlIiwicG9wdXBFZGl0QXZhdGFyIiwiZm9ybUVkaXQiLCJuYW1lSW5wdXQiLCJkZXNjcmlwdGlvbklucHV0IiwiZm9ybUFkZCIsInByb2ZpbGUiLCJlZGl0QnV0dG9uIiwiYWRkQnV0dG9uIiwiZWRpdEF2YXRhckJ1dHRvbiIsInBob3RvQ2FyZFRlbXBsYXRlIiwiY29udGVudCIsImZvcm1zIiwiTWFwIiwidmFsaWRhdGlvbkNvbmZpZyIsImZvcm1TZWxlY3RvciIsImNhcmRUb0RlbGV0ZSIsInJlbmRlckNhcmQiLCJjYXJkIiwibmV3Q2FyZCIsImNvbnN0YW50cyIsImhhbmRsZUNhcmREZWxldGVDbGljayIsInVzZXJJbmZvIiwicGhvdG9Qb3B1cCIsImRlbGV0ZVBvcHVwIiwiaXNMaWtlZCIsImFwaSIsImFkZExpa2UiLCJ0aGVuIiwicmVzIiwiY29uc29sZSIsImxvZyIsImNhdGNoIiwiZXJyIiwicmVtb3ZlTGlrZSIsIm9wdGlvbnMiLCJfb3B0aW9ucyIsImdldEluaXRpYWxDYXJkcyIsImZldGNoIiwiYmFzZVVybCIsImhlYWRlcnMiLCJfY2hlY2tSZXNwb25zZSIsInNldE5ld0NhcmQiLCJjYXJkTmFtZSIsImNhcmRMaW5rIiwibWV0aG9kIiwiYm9keSIsImdldFVzZXJJbmZvIiwic2V0VXNlckluZm8iLCJuZXdOYW1lIiwibmV3QWJvdXQiLCJhYm91dCIsInVwZGF0ZUF2YXRhciIsImF2YXRhciIsIm9rIiwianNvbiIsIlByb21pc2UiLCJyZWplY3QiLCJzdGF0dXMiLCJhdXRob3JpemF0aW9uIiwibmFtZVNlbGVjdG9yIiwiam9iU2VsZWN0b3IiLCJhdmF0YXJTZWxlY3RvciIsIl9uYW1lU2VsZWN0b3IiLCJfam9iU2VsZWN0b3IiLCJfYXZhdGFyU2VsZWN0b3IiLCJqb2IiLCJuYW1lRWxlbWVudCIsImpvYkVsZW1lbnQiLCJhdmF0YXJFbGVtZW50Iiwic2VjdGlvbiIsImFsbCIsInVzZXJEYXRhIiwiY2FyZHMiLCJhZGRQb3B1cCIsInBvcHVwIiwiaW5wdXREYXRhIiwiY2FyZERhdGEiLCJmaW5hbGx5IiwiZWRpdFBvcHVwIiwicGhvdG9JbWFnZSIsInBob3RvQ29udGFpbmVyIiwidGl0bGUiLCJlZGl0QXZhdGFyUG9wdXAiLCJmb3JtRWxlbWVudCIsImZvcm1OYW1lIiwiZm9ybVZhbGlkYXRvciIsImN1cnJlbnRVc2VySW5mbyJdLCJzb3VyY2VSb290IjoiIn0=